{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,iMAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/admin/wastage/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ntype VariantRow = { id: number; product_id: number; label: string; stock: number; sku: string; price: string };\ntype ProductRow = { id: number; name: string };\ntype WastageRow = { id: number; variant_id: number; qty: number; reason: string; note: string | null; wastage_at: string };\n\nconst n = (v: any) => (Number.isFinite(Number(v)) ? Number(v) : 0);\n\nexport default function WastagePage() {\n  const [variants, setVariants] = useState<VariantRow[]>([]);\n  const [history, setHistory] = useState<WastageRow[]>([]);\n  const [histLoading, setHistLoading] = useState(false);\n  const [products, setProducts] = useState<Record<number, ProductRow>>({});\n  const [variantId, setVariantId] = useState<number | \"\">(\"\");\n  const [qty, setQty] = useState(\"1\");\n  const [reason, setReason] = useState(\"Expired\");\n  const [note, setNote] = useState(\"\");\n\n  async function load() {\n    const [vRes, pRes, hRes] = await Promise.all([\n      supabase\n        .from(\"product_variants\")\n        .select(\"id,product_id,label,stock,sku,price\")\n        .order(\"id\", { ascending: true }),\n      supabase.from(\"products\").select(\"id,name\"),\n      supabase\n        .from(\"inventory_wastage\")\n        .select(\"id,variant_id,qty,reason,note,wastage_at\")\n        .order(\"wastage_at\", { ascending: false })\n        .limit(200),\n    ]);\n\n    if (vRes.error) return alert(vRes.error.message);\n    if (pRes.error) return alert(pRes.error.message);\n    if (hRes.error) return alert(hRes.error.message);\n\n    setVariants((vRes.data ?? []) as any);\n\n    const pm: Record<number, ProductRow> = {};\n    for (const p of pRes.data ?? []) pm[(p as any).id] = p as any;\n    setProducts(pm);\n\n    setHistory((hRes.data ?? []) as any);\n  }\n\n  useEffect(() => {\n    load();\n  }, []);\n\n  async function record() {\n    if (!variantId) return alert(\"Choose a variant\");\n    const q = Math.trunc(n(qty));\n    if (q <= 0) return alert(\"Qty must be > 0\");\n\n    const { error } = await supabase.rpc(\"record_wastage\", {\n      p_variant_id: Number(variantId),\n      p_qty: q,\n      p_reason: reason.trim() || \"Expired\",\n      p_note: note.trim() || null,\n    });\n\n    if (error) return alert(error.message);\n\n    setQty(\"1\");\n    setNote(\"\");\n    await load(); // refresh stock on screen\n  }\n\n  return (\n    <main className=\"min-h-screen bg-white text-black\">\n      <div className=\"max-w-6xl mx-auto px-4 py-6\">\n        <h1 className=\"text-xl font-semibold\">Wastage</h1>\n\n        <div className=\"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4\">\n          <div className=\"border rounded-2xl p-4\">\n            <div className=\"font-semibold\">Record wastage</div>\n\n            <div className=\"mt-3 space-y-2 text-sm\">\n              <select\n                className=\"w-full border rounded-xl px-3 py-2\"\n                value={variantId}\n                onChange={(e) => setVariantId(e.target.value ? Number(e.target.value) : \"\")}\n              >\n                <option value=\"\">Select variant…</option>\n                {variants.map((v) => (\n                  <option key={v.id} value={v.id}>\n                    #{v.id} • {products[v.product_id]?.name ?? \"Product\"} {v.label ? `(${v.label})` : \"\"} • stock:{v.stock}\n                  </option>\n                ))}\n              </select>\n\n              <input className=\"w-full border rounded-xl px-3 py-2\" value={qty} onChange={(e)=>setQty(e.target.value)} placeholder=\"Qty\" />\n              <input className=\"w-full border rounded-xl px-3 py-2\" value={reason} onChange={(e)=>setReason(e.target.value)} placeholder=\"Reason (Expired/Damaged/etc)\" />\n              <textarea className=\"w-full border rounded-xl px-3 py-2\" value={note} onChange={(e)=>setNote(e.target.value)} placeholder=\"Note (optional)\" rows={3} />\n\n              <button onClick={record} className=\"w-full rounded-full bg-blue-600 text-white py-2 font-semibold\">\n                Record wastage (decrements stock)\n              </button>\n            </div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4\">\n            <div className=\"font-semibold\">Recent wastage</div>\n            <div className=\"mt-3 space-y-2 text-sm\">\n              {history.length === 0 ? (\n                <div className=\"text-sm text-gray-600\">No wastage recorded yet.</div>\n              ) : (\n                history.slice(0, 20).map((w) => {\n                  const v = variants.find((x) => x.id === w.variant_id);\n                  const pname = v ? products[v.product_id]?.name ?? \"Product\" : \"Product\";\n                  const vlabel = v?.label ? ` (${v.label})` : \"\";\n\n                  return (\n                    <div key={w.id} className=\"flex justify-between border rounded-xl px-3 py-2\">\n                      <div>\n                        <div className=\"font-semibold\">\n                          {pname}\n                          {vlabel}\n                        </div>\n                        <div className=\"text-xs text-gray-600\">\n                          Variant #{w.variant_id} • Qty: {w.qty} • {w.reason}\n                        </div>\n                        {w.note ? <div className=\"text-xs text-gray-500\">{w.note}</div> : null}\n                      </div>\n                      <div className=\"text-xs text-gray-600\">{String(w.wastage_at)}</div>\n                    </div>\n                  );\n                })\n              )}\n            </div>\n\n            <div className=\"mt-6 border-t pt-4\">\n              <div className=\"font-semibold\">Quick stock view</div>\n              <div className=\"mt-3 space-y-2 text-sm\">\n                {variants.slice(0, 30).map((v) => (\n                  <div key={v.id} className=\"flex justify-between border rounded-xl px-3 py-2\">\n                    <div>\n                      <div className=\"font-semibold\">\n                        {products[v.product_id]?.name ?? \"Product\"} {v.label ? `(${v.label})` : \"\"}\n                      </div>\n                      <div className=\"text-xs text-gray-600\">Variant #{v.id} • {v.sku}</div>\n                    </div>\n                    <div className=\"font-semibold\">stock: {v.stock}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </main>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AASA,MAAM,IAAI,CAAC,IAAY,OAAO,QAAQ,CAAC,OAAO,MAAM,OAAO,KAAK;AAEjD,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAe,EAAE;IACzD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAe,EAAE;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAA6B,CAAC;IACtE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAc;IACxD,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;IAC/B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IAEjC,eAAe;QACb,MAAM,CAAC,MAAM,MAAM,KAAK,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC3C,oIAAQ,CACL,IAAI,CAAC,oBACL,MAAM,CAAC,uCACP,KAAK,CAAC,MAAM;gBAAE,WAAW;YAAK;YACjC,oIAAQ,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC;YACjC,oIAAQ,CACL,IAAI,CAAC,qBACL,MAAM,CAAC,4CACP,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAM,GACvC,KAAK,CAAC;SACV;QAED,IAAI,KAAK,KAAK,EAAE,OAAO,MAAM,KAAK,KAAK,CAAC,OAAO;QAC/C,IAAI,KAAK,KAAK,EAAE,OAAO,MAAM,KAAK,KAAK,CAAC,OAAO;QAC/C,IAAI,KAAK,KAAK,EAAE,OAAO,MAAM,KAAK,KAAK,CAAC,OAAO;QAE/C,YAAa,KAAK,IAAI,IAAI,EAAE;QAE5B,MAAM,KAAiC,CAAC;QACxC,KAAK,MAAM,KAAK,KAAK,IAAI,IAAI,EAAE,CAAE,EAAE,CAAC,AAAC,EAAU,EAAE,CAAC,GAAG;QACrD,YAAY;QAEZ,WAAY,KAAK,IAAI,IAAI,EAAE;IAC7B;IAEA,IAAA,0KAAS;iCAAC;YACR;QACF;gCAAG,EAAE;IAEL,eAAe;QACb,IAAI,CAAC,WAAW,OAAO,MAAM;QAC7B,MAAM,IAAI,KAAK,KAAK,CAAC,EAAE;QACvB,IAAI,KAAK,GAAG,OAAO,MAAM;QAEzB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CAAC,GAAG,CAAC,kBAAkB;YACrD,cAAc,OAAO;YACrB,OAAO;YACP,UAAU,OAAO,IAAI,MAAM;YAC3B,QAAQ,KAAK,IAAI,MAAM;QACzB;QAEA,IAAI,OAAO,OAAO,MAAM,MAAM,OAAO;QAErC,OAAO;QACP,QAAQ;QACR,MAAM,QAAQ,0BAA0B;IAC1C;IAEA,qBACE,6LAAC;QAAK,WAAU;kBACd,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAG,WAAU;8BAAwB;;;;;;8BAEtC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;8CAAgB;;;;;;8CAE/B,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CACC,WAAU;4CACV,OAAO;4CACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK,GAAG,OAAO,EAAE,MAAM,CAAC,KAAK,IAAI;;8DAExE,6LAAC;oDAAO,OAAM;8DAAG;;;;;;gDAChB,SAAS,GAAG,CAAC,CAAC,kBACb,6LAAC;wDAAkB,OAAO,EAAE,EAAE;;4DAAE;4DAC5B,EAAE,EAAE;4DAAC;4DAAI,QAAQ,CAAC,EAAE,UAAU,CAAC,EAAE,QAAQ;4DAAU;4DAAE,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG;4DAAG;4DAAU,EAAE,KAAK;;uDAD3F,EAAE,EAAE;;;;;;;;;;;sDAMrB,6LAAC;4CAAM,WAAU;4CAAqC,OAAO;4CAAK,UAAU,CAAC,IAAI,OAAO,EAAE,MAAM,CAAC,KAAK;4CAAG,aAAY;;;;;;sDACrH,6LAAC;4CAAM,WAAU;4CAAqC,OAAO;4CAAQ,UAAU,CAAC,IAAI,UAAU,EAAE,MAAM,CAAC,KAAK;4CAAG,aAAY;;;;;;sDAC3H,6LAAC;4CAAS,WAAU;4CAAqC,OAAO;4CAAM,UAAU,CAAC,IAAI,QAAQ,EAAE,MAAM,CAAC,KAAK;4CAAG,aAAY;4CAAkB,MAAM;;;;;;sDAElJ,6LAAC;4CAAO,SAAS;4CAAQ,WAAU;sDAAgE;;;;;;;;;;;;;;;;;;sCAMvG,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;8CAAgB;;;;;;8CAC/B,6LAAC;oCAAI,WAAU;8CACZ,QAAQ,MAAM,KAAK,kBAClB,6LAAC;wCAAI,WAAU;kDAAwB;;;;;+CAEvC,QAAQ,KAAK,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC;wCACxB,MAAM,IAAI,SAAS,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,EAAE,UAAU;wCACpD,MAAM,QAAQ,IAAI,QAAQ,CAAC,EAAE,UAAU,CAAC,EAAE,QAAQ,YAAY;wCAC9D,MAAM,SAAS,GAAG,QAAQ,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG;wCAE5C,qBACE,6LAAC;4CAAe,WAAU;;8DACxB,6LAAC;;sEACC,6LAAC;4DAAI,WAAU;;gEACZ;gEACA;;;;;;;sEAEH,6LAAC;4DAAI,WAAU;;gEAAwB;gEAC3B,EAAE,UAAU;gEAAC;gEAAS,EAAE,GAAG;gEAAC;gEAAI,EAAE,MAAM;;;;;;;wDAEnD,EAAE,IAAI,iBAAG,6LAAC;4DAAI,WAAU;sEAAyB,EAAE,IAAI;;;;;mEAAU;;;;;;;8DAEpE,6LAAC;oDAAI,WAAU;8DAAyB,OAAO,EAAE,UAAU;;;;;;;2CAXnD,EAAE,EAAE;;;;;oCAclB;;;;;;8CAIJ,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDAAgB;;;;;;sDAC/B,6LAAC;4CAAI,WAAU;sDACZ,SAAS,KAAK,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,kBAC1B,6LAAC;oDAAe,WAAU;;sEACxB,6LAAC;;8EACC,6LAAC;oEAAI,WAAU;;wEACZ,QAAQ,CAAC,EAAE,UAAU,CAAC,EAAE,QAAQ;wEAAU;wEAAE,EAAE,KAAK,GAAG,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG;;;;;;;8EAE1E,6LAAC;oEAAI,WAAU;;wEAAwB;wEAAU,EAAE,EAAE;wEAAC;wEAAI,EAAE,GAAG;;;;;;;;;;;;;sEAEjE,6LAAC;4DAAI,WAAU;;gEAAgB;gEAAQ,EAAE,KAAK;;;;;;;;mDAPtC,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBhC;GAjJwB;KAAA"}}]
}