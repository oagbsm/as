{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,iMAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/admin/track-money/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ntype PaymentRow = {\n  id: number;\n  order_id: number;\n  method: string;\n  amount: string | number;\n  status: string;\n  reference: string | null;\n  created_at: string;\n};\n\ntype ExpenseRow = {\n  id: number;\n  title: string;\n  category: string | null;\n  amount: string | number;\n  notes: string | null;\n  expense_date: string; // date\n  paid_method: string; // enum-ish string\n  created_at: string;\n};\n\ntype InvPayRow = {\n  id: number;\n  batch_id: number;\n  method: string;\n  amount: string | number;\n  status: string;\n  reference: string | null;\n  created_at: string;\n};\n\ntype InvBatchRow = {\n  id: number;\n  variant_id: number;\n  qty_received: number | string;\n  total_cost: number | string;\n  unit_cost: number | string;\n  received_at: string;\n};\n\ntype WastageRow = {\n  id: number;\n  variant_id: number;\n  qty: number | string;\n  reason?: string | null;\n  note?: string | null;\n  wastage_at: string;\n};\n\ntype OpeningRow = {\n  id?: number;\n  method?: string | null;\n  amount?: string | number | null;\n  opening_date?: string | null; // if you have it\n  created_at?: string | null;\n};\n\nconst METHODS = [\"EVC\", \"eDahab\", \"MERCHANT\", \"CASH\", \"PREMIER\"] as const;\ntype Method = (typeof METHODS)[number];\n\nfunction n(x: any) {\n  const v = Number(x ?? 0);\n  return Number.isFinite(v) ? v : 0;\n}\n\nfunction money(x: any) {\n  return new Intl.NumberFormat(\"en-GB\", { style: \"currency\", currency: \"GBP\" }).format(n(x));\n}\n\ntype AnyRow = Record<string, any>;\n\nfunction toCsv(rowsInput: unknown) {\n  const rows: AnyRow[] = Array.isArray(rowsInput) ? (rowsInput as AnyRow[]) : [];\n  if (rows.length === 0) return \"\";\n\n  const colSet = new Set<string>();\n  for (const r of rows) Object.keys(r ?? {}).forEach((k) => colSet.add(k));\n  const cols = [...colSet];\n\n  const esc = (v: any) => {\n    const s = v == null ? \"\" : String(v);\n    // wrap + escape quotes\n    return `\"${s.replace(/\"/g, '\"\"')}\"`;\n  };\n\n  const header = cols.map(esc).join(\",\");\n  const body = rows\n    .map((r) => cols.map((c) => esc((r as AnyRow)[c])).join(\",\"))\n    .join(\"\\n\");\n\n  return `${header}\\n${body}`;\n}\n\nexport default function TrackMoneyPage() {\n  const today = new Date();\n  const yyyyMmDd = today.toISOString().slice(0, 10);\n\n  const [fromDate, setFromDate] = useState(yyyyMmDd);\n  const [toDate, setToDate] = useState(yyyyMmDd);\n\n  const [loading, setLoading] = useState(true);\n  const [err, setErr] = useState<string | null>(null);\n\n  const [payments, setPayments] = useState<PaymentRow[]>([]);\n  const [expenses, setExpenses] = useState<ExpenseRow[]>([]);\n  const [invPays, setInvPays] = useState<InvPayRow[]>([]);\n  const [invBatches, setInvBatches] = useState<InvBatchRow[]>([]);\n  const [wastageRows, setWastageRows] = useState<WastageRow[]>([]);\n  const [wastageMissing, setWastageMissing] = useState(false);\n\n  const [openings, setOpenings] = useState<OpeningRow[]>([]);\n  const [openingsMissing, setOpeningsMissing] = useState(false);\n\n  useEffect(() => {\n    let alive = true;\n\n    (async () => {\n      try {\n        setLoading(true);\n        setErr(null);\n\n        // Payments in range: created_at between from and to+1 day\n        const toPlus1 = new Date(`${toDate}T00:00:00.000Z`);\n        toPlus1.setUTCDate(toPlus1.getUTCDate() + 1);\n        const toIso = toPlus1.toISOString();\n\n        const [pRes, eRes, ipRes, bRes] = await Promise.all([\n          supabase\n            .from(\"payments\")\n            .select(\"id,order_id,method,amount,status,reference,created_at\")\n            .eq(\"status\", \"SUCCESS\")\n            .gte(\"created_at\", `${fromDate}T00:00:00.000Z`)\n            .lt(\"created_at\", toIso)\n            .order(\"created_at\", { ascending: false })\n            .limit(5000),\n\n          // expenses use expense_date (date) in your schema\n          supabase\n            .from(\"expenses\")\n            .select(\"id,title,category,amount,notes,expense_date,paid_method,created_at\")\n            .gte(\"expense_date\", fromDate)\n            .lte(\"expense_date\", toDate)\n            .order(\"expense_date\", { ascending: false })\n            .limit(5000),\n\n          supabase\n            .from(\"inventory_payments\")\n            .select(\"id,batch_id,method,amount,status,reference,created_at\")\n            .eq(\"status\", \"SUCCESS\")\n            .gte(\"created_at\", `${fromDate}T00:00:00.000Z`)\n            .lt(\"created_at\", toIso)\n            .order(\"created_at\", { ascending: false })\n            .limit(5000),\n\n          // inventory cost (for profit calc) uses inventory_batches total_cost\n          supabase\n.from(\"inventory_batches\")\n.select(\"id,variant_id,qty_received,total_cost,unit_cost,received_at\")\n            .gte(\"received_at\", `${fromDate}T00:00:00.000Z`)\n            .lt(\"received_at\", toIso)\n            .order(\"received_at\", { ascending: false })\n            .limit(5000),\n        ]);\n\n        if (pRes.error) throw pRes.error;\n        if (eRes.error) throw eRes.error;\n        if (ipRes.error) throw ipRes.error;\n        if (bRes.error) throw bRes.error;\n\n        // wastage is optional; attempt load (not fatal)\n        let wData: WastageRow[] = [];\n        let wMissing = false;\n        try {\n          const wRes = await supabase\n.from(\"inventory_wastage\")\n.select(\"id,variant_id,qty,wastage_at,reason,note\")\n  .gte(\"wastage_at\", `${fromDate}T00:00:00.000Z`)\n  .lt(\"wastage_at\", toIso)\n  .order(\"wastage_at\", { ascending: false })\n  .limit(5000);\n\n          if (wRes.error) {\n            wMissing = true;\n          } else {\n            wData = (wRes.data ?? []) as any;\n          }\n        } catch {\n          wMissing = true;\n        }\n\n        // wallet_openings is optional (you may not have created it)\n        let oData: OpeningRow[] = [];\n        let missing = false;\n\n        const oRes = await supabase\n          .from(\"wallet_openings\")\n          .select(\"*\")\n          .order(\"created_at\", { ascending: false })\n          .limit(2000);\n\n        if (oRes.error) {\n          // If table doesn't exist or RLS blocks it, we just treat openings as 0\n          missing = true;\n        } else {\n          oData = (oRes.data ?? []) as any;\n        }\n\n        if (!alive) return;\n\n        setPayments((pRes.data ?? []) as any);\n        setExpenses((eRes.data ?? []) as any);\n        setInvPays((ipRes.data ?? []) as any);\n        setInvBatches((bRes.data ?? []) as any);\n        setWastageRows(wData);\n        setWastageMissing(wMissing);\n\n        setOpenings(oData);\n        setOpeningsMissing(missing);\n      } catch (e: any) {\n        if (!alive) return;\n        setErr(e?.message || \"Failed to load track money data\");\n      } finally {\n        if (alive) setLoading(false);\n      }\n    })();\n\n    return () => {\n      alive = false;\n    };\n  }, [fromDate, toDate]);\n\n  const openingsByMethod = useMemo(() => {\n    // We support two patterns:\n    // 1) method + amount only (latest row per method is used)\n    // 2) opening_date exists (you can filter later if you want)\n    const m: Record<string, number> = {};\n    for (const row of openings) {\n      const method = String((row as any).method ?? \"\").trim();\n      if (!method) continue;\n      if (m[method] == null) m[method] = n((row as any).amount);\n      // If there are multiple rows, we keep the most recent because we ordered desc\n    }\n    return m;\n  }, [openings]);\n\n  const sums = useMemo(() => {\n    const inflowBy: Record<string, number> = {};\n    const outflowBy: Record<string, number> = {};\n\n    for (const m of METHODS) {\n      inflowBy[m] = 0;\n      outflowBy[m] = 0;\n    }\n\n    // Money IN: payments\n    for (const p of payments) {\n      const method = String(p.method ?? \"\").trim();\n      const amt = n(p.amount);\n      if (!method) continue;\n      inflowBy[method] = (inflowBy[method] ?? 0) + amt;\n    }\n\n    // Money OUT: expenses + inventory_payments (CASH FLOW ONLY)\n    for (const e of expenses) {\n      const method = String(e.paid_method ?? \"\").trim();\n      const amt = n(e.amount);\n      if (!method) continue;\n      outflowBy[method] = (outflowBy[method] ?? 0) + amt;\n    }\n\n    for (const ip of invPays) {\n      const method = String(ip.method ?? \"\").trim();\n      const amt = n(ip.amount);\n      if (!method) continue;\n      outflowBy[method] = (outflowBy[method] ?? 0) + amt;\n    }\n\n    const wallet: Record<string, number> = {};\n    for (const m of METHODS) {\n      const opening = openingsByMethod[m] ?? 0; // if missing, defaults to 0\n      wallet[m] = opening + (inflowBy[m] ?? 0) - (outflowBy[m] ?? 0);\n    }\n\n    const totalSales = payments.reduce((s, p) => s + n(p.amount), 0);\n    const totalExpenses = expenses.reduce((s, e) => s + n(e.amount), 0);\n    const totalInvPaid = invPays.reduce((s, ip) => s + n(ip.amount), 0);\n\n    // PROFIT COSTS (ACCRUAL-LIKE SIMPLE MODEL)\n    // Inventory cost uses received total_cost (NOT payments), so unpaid inventory still affects profit.\n    const inventoryCost = invBatches.reduce((s, b) => s + n((b as any).total_cost), 0);\n\n    // Wastage reduces profit (NOT wallets). We try total_cost first, then cost, then amount.\n// ===== WASTAGE COST (uses unit_cost from inventory_batches) =====\nconst unitAgg: Record<string, { qty: number; cost: number }> = {};\n\nfor (const b of invBatches) {\n  const vid = String((b as any).variant_id ?? \"\");\n  const q = n((b as any).qty_received);\n  const u = n((b as any).unit_cost);\n\n  if (!vid || q <= 0 || u <= 0) continue;\n\n  if (!unitAgg[vid]) unitAgg[vid] = { qty: 0, cost: 0 };\n  unitAgg[vid].qty += q;\n  unitAgg[vid].cost += q * u;\n}\n\nconst unitCostByVariant: Record<string, number> = {};\nfor (const vid of Object.keys(unitAgg)) {\n  unitCostByVariant[vid] = unitAgg[vid].cost / Math.max(1, unitAgg[vid].qty);\n}\n\nconst wastageCost = wastageRows.reduce((s, w) => {\n  const vid = String((w as any).variant_id ?? \"\");\n  const q = n((w as any).qty);\n  return s + q * (unitCostByVariant[vid] ?? 0);\n}, 0);\n\n    const grossProfit = totalSales - inventoryCost - wastageCost;\n    const netProfit = grossProfit - totalExpenses;\n\n    return {\n      inflowBy,\n      outflowBy,\n      wallet,\n      totalSales,\n      totalExpenses,\n      totalInvPaid,\n      inventoryCost,\n      wastageCost,\n      grossProfit,\n      netProfit,\n    };\n  }, [payments, expenses, invPays, invBatches, wastageRows, openingsByMethod]);\n\n  const statement = useMemo(() => {\n    // unified statement for export/view (cashflow statement)\n    const rows: Array<{\n      when: string;\n      type: \"SALE\" | \"EXPENSE\" | \"INVENTORY\";\n      method: string;\n      in_amount: number;\n      out_amount: number;\n      ref: string;\n    }> = [];\n\n    for (const p of payments) {\n      rows.push({\n        when: p.created_at,\n        type: \"SALE\",\n        method: String(p.method ?? \"\"),\n        in_amount: n(p.amount),\n        out_amount: 0,\n        ref: p.reference ? String(p.reference) : `order#${p.order_id}`,\n      });\n    }\n\n    for (const e of expenses) {\n      rows.push({\n        when: e.expense_date, // date\n        type: \"EXPENSE\",\n        method: String(e.paid_method ?? \"\"),\n        in_amount: 0,\n        out_amount: n(e.amount),\n        ref: e.title ? String(e.title) : `expense#${e.id}`,\n      });\n    }\n\n    for (const ip of invPays) {\n      rows.push({\n        when: ip.created_at,\n        type: \"INVENTORY\",\n        method: String(ip.method ?? \"\"),\n        in_amount: 0,\n        out_amount: n(ip.amount),\n        ref: ip.reference ? String(ip.reference) : `batch#${ip.batch_id}`,\n      });\n    }\n\n    // Sort newest first (best effort with mixed date formats)\n    rows.sort((a, b) => String(b.when).localeCompare(String(a.when)));\n    return rows;\n  }, [payments, expenses, invPays]);\n\n  function exportCsv() {\n    const csv = toCsv(\n      statement.map((r) => ({\n        when: r.when,\n        type: r.type,\n        method: r.method,\n        in_amount: r.in_amount,\n        out_amount: r.out_amount,\n        ref: r.ref,\n      }))\n    );\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `wallet-statement_${fromDate}_to_${toDate}.csv`;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n    URL.revokeObjectURL(url);\n  }\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 text-black\">\n      <div className=\"max-w-7xl mx-auto px-4 py-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div>\n            <Link href=\"/admin\" className=\"text-sm text-blue-600 hover:underline\">\n              ← Admin\n            </Link>\n            <h1 className=\"text-xl font-semibold mt-2\">Track Money</h1>\n            <p className=\"text-xs text-gray-600 mt-1\">\n              Wallet balances = Opening + Sales − Inventory payments − Expenses.\n            </p>\n            <p className=\"text-xs text-gray-600 mt-1\">\n              Profit = Revenue − Inventory cost(received) − Wastage − Expenses.\n            </p>\n          </div>\n\n          <div className=\"flex flex-col items-end gap-2\">\n            <div className=\"flex items-center gap-2 text-sm\">\n              <label className=\"text-xs text-gray-600\">From</label>\n              <input\n                type=\"date\"\n                value={fromDate}\n                onChange={(e) => setFromDate(e.target.value)}\n                className=\"border rounded-full px-3 py-2 text-sm bg-white\"\n              />\n              <label className=\"text-xs text-gray-600\">To</label>\n              <input\n                type=\"date\"\n                value={toDate}\n                onChange={(e) => setToDate(e.target.value)}\n                className=\"border rounded-full px-3 py-2 text-sm bg-white\"\n              />\n            </div>\n\n            <button\n              onClick={exportCsv}\n              disabled={loading || statement.length === 0}\n              className=\"px-4 py-2 rounded-full border bg-white text-sm font-semibold hover:bg-gray-50 disabled:opacity-50\"\n            >\n              Export wallet statement (CSV)\n            </button>\n          </div>\n        </div>\n\n        {err ? (\n          <div className=\"mt-4 border rounded-2xl p-4 bg-white text-sm text-red-600\">{err}</div>\n        ) : null}\n\n        {openingsMissing ? (\n          <div className=\"mt-4 border rounded-2xl p-4 bg-white text-sm text-amber-700\">\n            Note: <span className=\"font-semibold\">wallet_openings</span> table not found (or blocked by\n            RLS). Openings are treated as <span className=\"font-semibold\">0</span>.\n          </div>\n        ) : null}\n\n        {wastageMissing ? (\n          <div className=\"mt-4 border rounded-2xl p-4 bg-white text-sm text-amber-700\">\n            Note: <span className=\"font-semibold\">wastage</span> table not found (or blocked by RLS).\n            Wastage cost is treated as <span className=\"font-semibold\">0</span>.\n          </div>\n        ) : null}\n\n        {/* Summary: revenue / cost / profit */}\n        <section className=\"mt-4 grid grid-cols-2 lg:grid-cols-3 gap-3\">\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Revenue (Sales)</div>\n            <div className=\"mt-1 text-lg font-semibold\">{loading ? \"…\" : money(sums.totalSales)}</div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Inventory cost (received)</div>\n            <div className=\"mt-1 text-lg font-semibold\">\n              {loading ? \"…\" : money(sums.inventoryCost)}\n            </div>\n            <div className=\"mt-2 text-[11px] text-gray-500 leading-4\">\n              Paid to suppliers: {loading ? \"…\" : money(sums.totalInvPaid)}\n            </div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Wastage cost</div>\n            <div className=\"mt-1 text-lg font-semibold\">\n              {loading ? \"…\" : money(sums.wastageCost)}\n            </div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Gross profit</div>\n            <div className=\"mt-1 text-lg font-semibold\">\n              {loading ? \"…\" : money(sums.grossProfit)}\n            </div>\n            <div className=\"mt-2 text-[11px] text-gray-500 leading-4\">Revenue − Inventory − Wastage</div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Expenses</div>\n            <div className=\"mt-1 text-lg font-semibold\">\n              {loading ? \"…\" : money(sums.totalExpenses)}\n            </div>\n          </div>\n\n          <div className=\"border rounded-2xl p-4 bg-white\">\n            <div className=\"text-xs text-gray-500\">Net profit</div>\n            <div\n              className={`mt-1 text-lg font-semibold ${\n                !loading && sums.netProfit < 0 ? \"text-red-600\" : \"\"\n              }`}\n            >\n              {loading ? \"…\" : money(sums.netProfit)}\n            </div>\n            <div className=\"mt-2 text-[11px] text-gray-500 leading-4\">Gross profit − Expenses</div>\n          </div>\n        </section>\n\n        {/* Wallet balances */}\n        <section className=\"mt-4 border rounded-2xl bg-white p-4\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <div className=\"font-semibold\">Wallet balances</div>\n            <div className=\"text-xs text-gray-600\">\n              Default wallets shown (even if your enum doesn’t include them yet).\n            </div>\n          </div>\n\n          {/* 2 cols phone, 5 cols desktop (because 5 wallets) */}\n          <div className=\"mt-3 grid grid-cols-2 lg:grid-cols-5 gap-3\">\n            {METHODS.map((m) => {\n              const bal = sums.wallet[m] ?? 0;\n              const neg = bal < -0.0001;\n              return (\n                <div key={m} className=\"border rounded-2xl p-4\">\n                  <div className=\"text-xs text-gray-500\">{m}</div>\n                  <div className={`mt-1 text-lg font-semibold ${neg ? \"text-red-600\" : \"\"}`}>\n                    {loading ? \"…\" : money(bal)}\n                  </div>\n                  <div className=\"mt-2 text-[11px] text-gray-500 leading-4\">\n                    In: {loading ? \"…\" : money(sums.inflowBy[m] ?? 0)} • Out:{\" \"}\n                    {loading ? \"…\" : money(sums.outflowBy[m] ?? 0)}\n                  </div>\n                  {neg ? <div className=\"mt-2 text-[11px] text-red-600\">Negative balance</div> : null}\n                </div>\n              );\n            })}\n          </div>\n        </section>\n\n        {/* Statement */}\n        <section className=\"mt-4 border rounded-2xl bg-white p-4\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <div className=\"font-semibold\">Recent wallet statement</div>\n            <div className=\"text-xs text-gray-600\">\n              Showing {loading ? \"…\" : Math.min(statement.length, 100)} rows\n            </div>\n          </div>\n\n          <div className=\"mt-3 space-y-2\">\n            {(loading ? Array.from({ length: 8 }) : statement.slice(0, 100)).map(\n              (r: any, idx: number) => {\n                if (loading) return <div key={idx} className=\"h-10 bg-gray-100 rounded-xl\" />;\n\n                const isIn = r.in_amount > 0;\n                return (\n                  <div\n                    key={`${r.type}-${idx}`}\n                    className=\"flex items-center justify-between text-sm border rounded-xl px-3 py-2\"\n                  >\n                    <div className=\"min-w-0\">\n                      <div className=\"font-semibold\">\n                        {r.type} • {r.method}\n                      </div>\n                      <div className=\"text-xs text-gray-600 truncate\">\n                        {String(r.when)} • {r.ref}\n                      </div>\n                    </div>\n                    <div className={`font-semibold ${isIn ? \"text-green-700\" : \"text-red-600\"}`}>\n                      {isIn ? `+${money(r.in_amount)}` : `-${money(r.out_amount)}`}\n                    </div>\n                  </div>\n                );\n              }\n            )}\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}"],"names":[],"mappings":"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"}}]
}