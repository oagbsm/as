{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,WAAW,IAAA,iMAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/admin/analytics/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ntype Row = {\n  product_id: number;\n  product_name: string;\n  total_qty: number;\n  orders_count: number;\n  revenue: string | number;\n  avg_qty_per_day: string | number;\n};\n\nfunction money(n: any) {\n  const x = Number(n ?? 0);\n  return new Intl.NumberFormat(\"en-GB\", { style: \"currency\", currency: \"GBP\" }).format(x);\n}\n\nfunction toISODate(d: Date) {\n  // YYYY-MM-DD (local)\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nexport default function AdminAnalyticsPage() {\n  const today = useMemo(() => new Date(), []);\n  const defaultEnd = toISODate(today);\n  const defaultStart = toISODate(new Date(today.getFullYear(), today.getMonth(), today.getDate() - 29));\n\n  const [start, setStart] = useState(defaultStart);\n  const [end, setEnd] = useState(defaultEnd);\n  const [limit, setLimit] = useState(20);\n\n  const [loading, setLoading] = useState(true);\n  const [err, setErr] = useState<string | null>(null);\n  const [rows, setRows] = useState<Row[]>([]);\n\n  async function load() {\n    try {\n      setLoading(true);\n      setErr(null);\n\n      const { data, error } = await supabase.rpc(\"analytics_top_products\", {\n        p_start: start,\n        p_end: end,\n        p_limit: limit,\n      });\n\n      if (error) throw error;\n      setRows((data ?? []) as Row[]);\n    } catch (e: any) {\n      setErr(e?.message || \"Failed to load analytics\");\n      setRows([]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    load();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const stats = useMemo(() => {\n    const totalQty = rows.reduce((s, r) => s + Number(r.total_qty ?? 0), 0);\n    const revenue = rows.reduce((s, r) => s + Number(r.revenue ?? 0), 0);\n    const avgPerDay = rows.reduce((s, r) => s + Number(r.avg_qty_per_day ?? 0), 0);\n    return { totalQty, revenue, avgPerDay };\n  }, [rows]);\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 text-black\">\n      <div className=\"max-w-6xl mx-auto px-4 py-6\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div>\n            <Link href=\"/admin\" className=\"text-sm text-blue-600 hover:underline\">\n              ← Admin\n            </Link>\n            <h1 className=\"text-xl font-semibold mt-2\">Analytics</h1>\n            <p className=\"text-xs text-gray-600 mt-1\">\n              Most bought products + average qty per day (based on orders + order_items).\n            </p>\n          </div>\n\n          <button\n            onClick={load}\n            className=\"h-10 px-4 rounded-xl bg-black text-white text-sm\"\n            disabled={loading}\n          >\n            {loading ? \"Loading...\" : \"Refresh\"}\n          </button>\n        </div>\n\n        {/* Filters */}\n        <section className=\"mt-4 border rounded-2xl bg-white p-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\n            <div>\n              <div className=\"text-xs text-gray-600 mb-1\">Start</div>\n              <input\n                type=\"date\"\n                value={start}\n                onChange={(e) => setStart(e.target.value)}\n                className=\"w-full h-10 rounded-xl border px-3 text-sm\"\n              />\n            </div>\n            <div>\n              <div className=\"text-xs text-gray-600 mb-1\">End</div>\n              <input\n                type=\"date\"\n                value={end}\n                onChange={(e) => setEnd(e.target.value)}\n                className=\"w-full h-10 rounded-xl border px-3 text-sm\"\n              />\n            </div>\n            <div>\n              <div className=\"text-xs text-gray-600 mb-1\">Top</div>\n              <input\n                type=\"number\"\n                min={5}\n                max={200}\n                value={limit}\n                onChange={(e) => setLimit(Number(e.target.value || 20))}\n                className=\"w-full h-10 rounded-xl border px-3 text-sm\"\n              />\n            </div>\n            <div className=\"flex items-end\">\n              <button\n                onClick={load}\n                className=\"w-full h-10 rounded-xl bg-blue-600 text-white text-sm\"\n                disabled={loading}\n              >\n                Apply\n              </button>\n            </div>\n          </div>\n\n          <div className=\"mt-4 grid grid-cols-2 lg:grid-cols-4 gap-3\">\n            <div className=\"border rounded-2xl p-4\">\n              <div className=\"text-xs text-gray-500\">Products (shown)</div>\n              <div className=\"mt-1 text-lg font-semibold\">{loading ? \"…\" : rows.length}</div>\n            </div>\n            <div className=\"border rounded-2xl p-4\">\n              <div className=\"text-xs text-gray-500\">Total qty (shown)</div>\n              <div className=\"mt-1 text-lg font-semibold\">{loading ? \"…\" : stats.totalQty}</div>\n            </div>\n            <div className=\"border rounded-2xl p-4\">\n              <div className=\"text-xs text-gray-500\">Revenue (shown)</div>\n              <div className=\"mt-1 text-lg font-semibold\">{loading ? \"…\" : money(stats.revenue)}</div>\n            </div>\n            <div className=\"border rounded-2xl p-4\">\n              <div className=\"text-xs text-gray-500\">Sum avg/day (shown)</div>\n              <div className=\"mt-1 text-lg font-semibold\">\n                {loading ? \"…\" : Number(stats.avgPerDay).toFixed(2)}\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {err ? (\n          <div className=\"mt-4 border rounded-2xl p-4 bg-white text-sm text-red-600\">{err}</div>\n        ) : null}\n\n        {/* Table */}\n        <section className=\"mt-4 border rounded-2xl bg-white overflow-hidden\">\n          <div className=\"p-4 font-semibold\">Top products</div>\n\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full text-sm\">\n              <thead className=\"bg-gray-50 text-gray-600\">\n                <tr>\n                  <th className=\"text-left px-4 py-3\">#</th>\n                  <th className=\"text-left px-4 py-3\">Product</th>\n                  <th className=\"text-right px-4 py-3\">Qty</th>\n                  <th className=\"text-right px-4 py-3\">Avg / day</th>\n                  <th className=\"text-right px-4 py-3\">Orders</th>\n                  <th className=\"text-right px-4 py-3\">Revenue</th>\n                </tr>\n              </thead>\n              <tbody>\n                {(loading ? Array.from({ length: 8 }) : rows).map((r: any, idx: number) => (\n                  <tr key={r?.product_id ?? idx} className=\"border-t\">\n                    <td className=\"px-4 py-3 text-gray-500\">{idx + 1}</td>\n                    <td className=\"px-4 py-3\">\n                      <div className=\"font-medium\">{r?.product_name ?? \"…\"}</div>\n                      <div className=\"text-xs text-gray-500\">ID: {r?.product_id ?? \"…\"}</div>\n                    </td>\n                    <td className=\"px-4 py-3 text-right font-semibold\">{r?.total_qty ?? \"…\"}</td>\n                    <td className=\"px-4 py-3 text-right\">\n                      {r?.avg_qty_per_day != null ? Number(r.avg_qty_per_day).toFixed(2) : \"…\"}\n                    </td>\n                    <td className=\"px-4 py-3 text-right\">{r?.orders_count ?? \"…\"}</td>\n                    <td className=\"px-4 py-3 text-right font-semibold\">{money(r?.revenue)}</td>\n                  </tr>\n                ))}\n                {!loading && rows.length === 0 ? (\n                  <tr>\n                    <td className=\"px-4 py-6 text-sm text-gray-600\" colSpan={6}>\n                      No results for this range. (Make sure order_items.product_id is being saved.)\n                    </td>\n                  </tr>\n                ) : null}\n              </tbody>\n            </table>\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAeA,SAAS,MAAM,CAAM;IACnB,MAAM,IAAI,OAAO,KAAK;IACtB,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QAAE,OAAO;QAAY,UAAU;IAAM,GAAG,MAAM,CAAC;AACvF;AAEA,SAAS,UAAU,CAAO;IACxB,qBAAqB;IACrB,MAAM,OAAO,EAAE,WAAW;IAC1B,MAAM,KAAK,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IAChD,MAAM,KAAK,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC3C,OAAO,GAAG,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE,IAAI;AAC9B;AAEe,SAAS;;IACtB,MAAM,QAAQ,IAAA,wKAAO;6CAAC,IAAM,IAAI;4CAAQ,EAAE;IAC1C,MAAM,aAAa,UAAU;IAC7B,MAAM,eAAe,UAAU,IAAI,KAAK,MAAM,WAAW,IAAI,MAAM,QAAQ,IAAI,MAAM,OAAO,KAAK;IAEjG,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;IAC/B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IAEnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAgB;IAC9C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAE1C,eAAe;QACb,IAAI;YACF,WAAW;YACX,OAAO;YAEP,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CAAC,GAAG,CAAC,0BAA0B;gBACnE,SAAS;gBACT,OAAO;gBACP,SAAS;YACX;YAEA,IAAI,OAAO,MAAM;YACjB,QAAS,QAAQ,EAAE;QACrB,EAAE,OAAO,GAAQ;YACf,OAAO,GAAG,WAAW;YACrB,QAAQ,EAAE;QACZ,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAA,0KAAS;wCAAC;YACR;QACA,uDAAuD;QACzD;uCAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,wKAAO;6CAAC;YACpB,MAAM,WAAW,KAAK,MAAM;8DAAC,CAAC,GAAG,IAAM,IAAI,OAAO,EAAE,SAAS,IAAI;6DAAI;YACrE,MAAM,UAAU,KAAK,MAAM;6DAAC,CAAC,GAAG,IAAM,IAAI,OAAO,EAAE,OAAO,IAAI;4DAAI;YAClE,MAAM,YAAY,KAAK,MAAM;+DAAC,CAAC,GAAG,IAAM,IAAI,OAAO,EAAE,eAAe,IAAI;8DAAI;YAC5E,OAAO;gBAAE;gBAAU;gBAAS;YAAU;QACxC;4CAAG;QAAC;KAAK;IAET,qBACE,6LAAC;QAAK,WAAU;kBACd,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;;8CACC,6LAAC,0KAAI;oCAAC,MAAK;oCAAS,WAAU;8CAAwC;;;;;;8CAGtE,6LAAC;oCAAG,WAAU;8CAA6B;;;;;;8CAC3C,6LAAC;oCAAE,WAAU;8CAA6B;;;;;;;;;;;;sCAK5C,6LAAC;4BACC,SAAS;4BACT,WAAU;4BACV,UAAU;sCAET,UAAU,eAAe;;;;;;;;;;;;8BAK9B,6LAAC;oBAAQ,WAAU;;sCACjB,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAI,WAAU;sDAA6B;;;;;;sDAC5C,6LAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4CACxC,WAAU;;;;;;;;;;;;8CAGd,6LAAC;;sDACC,6LAAC;4CAAI,WAAU;sDAA6B;;;;;;sDAC5C,6LAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;4CACtC,WAAU;;;;;;;;;;;;8CAGd,6LAAC;;sDACC,6LAAC;4CAAI,WAAU;sDAA6B;;;;;;sDAC5C,6LAAC;4CACC,MAAK;4CACL,KAAK;4CACL,KAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,SAAS,OAAO,EAAE,MAAM,CAAC,KAAK,IAAI;4CACnD,WAAU;;;;;;;;;;;;8CAGd,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCACC,SAAS;wCACT,WAAU;wCACV,UAAU;kDACX;;;;;;;;;;;;;;;;;sCAML,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDAAwB;;;;;;sDACvC,6LAAC;4CAAI,WAAU;sDAA8B,UAAU,MAAM,KAAK,MAAM;;;;;;;;;;;;8CAE1E,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDAAwB;;;;;;sDACvC,6LAAC;4CAAI,WAAU;sDAA8B,UAAU,MAAM,MAAM,QAAQ;;;;;;;;;;;;8CAE7E,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDAAwB;;;;;;sDACvC,6LAAC;4CAAI,WAAU;sDAA8B,UAAU,MAAM,MAAM,MAAM,OAAO;;;;;;;;;;;;8CAElF,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;sDAAwB;;;;;;sDACvC,6LAAC;4CAAI,WAAU;sDACZ,UAAU,MAAM,OAAO,MAAM,SAAS,EAAE,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;gBAMxD,oBACC,6LAAC;oBAAI,WAAU;8BAA6D;;;;;2BAC1E;8BAGJ,6LAAC;oBAAQ,WAAU;;sCACjB,6LAAC;4BAAI,WAAU;sCAAoB;;;;;;sCAEnC,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAM,WAAU;;kDACf,6LAAC;wCAAM,WAAU;kDACf,cAAA,6LAAC;;8DACC,6LAAC;oDAAG,WAAU;8DAAsB;;;;;;8DACpC,6LAAC;oDAAG,WAAU;8DAAsB;;;;;;8DACpC,6LAAC;oDAAG,WAAU;8DAAuB;;;;;;8DACrC,6LAAC;oDAAG,WAAU;8DAAuB;;;;;;8DACrC,6LAAC;oDAAG,WAAU;8DAAuB;;;;;;8DACrC,6LAAC;oDAAG,WAAU;8DAAuB;;;;;;;;;;;;;;;;;kDAGzC,6LAAC;;4CACE,CAAC,UAAU,MAAM,IAAI,CAAC;gDAAE,QAAQ;4CAAE,KAAK,IAAI,EAAE,GAAG,CAAC,CAAC,GAAQ,oBACzD,6LAAC;oDAA8B,WAAU;;sEACvC,6LAAC;4DAAG,WAAU;sEAA2B,MAAM;;;;;;sEAC/C,6LAAC;4DAAG,WAAU;;8EACZ,6LAAC;oEAAI,WAAU;8EAAe,GAAG,gBAAgB;;;;;;8EACjD,6LAAC;oEAAI,WAAU;;wEAAwB;wEAAK,GAAG,cAAc;;;;;;;;;;;;;sEAE/D,6LAAC;4DAAG,WAAU;sEAAsC,GAAG,aAAa;;;;;;sEACpE,6LAAC;4DAAG,WAAU;sEACX,GAAG,mBAAmB,OAAO,OAAO,EAAE,eAAe,EAAE,OAAO,CAAC,KAAK;;;;;;sEAEvE,6LAAC;4DAAG,WAAU;sEAAwB,GAAG,gBAAgB;;;;;;sEACzD,6LAAC;4DAAG,WAAU;sEAAsC,MAAM,GAAG;;;;;;;mDAXtD,GAAG,cAAc;;;;;4CAc3B,CAAC,WAAW,KAAK,MAAM,KAAK,kBAC3B,6LAAC;0DACC,cAAA,6LAAC;oDAAG,WAAU;oDAAkC,SAAS;8DAAG;;;;;;;;;;uDAI5D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQpB;GAxLwB;KAAA"}}]
}