{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,8LAAY"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/db.ts"],"sourcesContent":["// lib/db.ts\nimport { supabase } from \"@/lib/supabaseClient\";\n\n/* =========================\n   Helpers\n========================= */\n\nexport function safeImg(src: any) {\n  const s = String(src ?? \"\").trim();\n  if (!s) return \"/example.png\";\n  if (s.startsWith(\"/\")) return s;\n  if (s.startsWith(\"http://\") || s.startsWith(\"https://\")) return s;\n  return \"/example.png\";\n}\n\n/* =========================\n   Types\n========================= */\n\ntype CategoryRow = {\n  id: number;\n  slug: string;\n  img: string | null;\n  name_so: string;\n  name_en: string;\n};\n\ntype SubcategoryRow = {\n  id: number;\n  category_id: number;\n  slug: string;\n  img: string | null;\n  name_so: string;\n  name_en: string;\n};\n\nexport type ProductRow = {\n  id: number;\n  name: string;\n  slug: string;\n  base_price: number; // numeric NOT NULL in DB\n  long_description: string; // NOT NULL in DB\n  category_id: number;\n  subcategory_id: number;\n  brand_id: number;\n  is_discounted: boolean;\n  tags?: string[] | null;\n  is_active: boolean;\n};\nexport type VariantRow = {\n  id: number;\n  product_id: number;\n  label: string;\n  price: number;\n\n  // optional if you track stock\n  stock?: number | null;\n};\n\n/* =========================\n   Home (categories + subcats)\n========================= */\n\nexport async function getCategoriesWithSubcategories() {\n  const { data: cats, error: catErr } = await supabase\n    .from(\"categories\")\n    .select(\"id,slug,img,name_so,name_en\")\n    .order(\"id\", { ascending: true });\n\n  if (catErr) throw catErr;\n\n  const { data: subs, error: subErr } = await supabase\n    .from(\"subcategories\")\n    .select(\"id,category_id,slug,img,name_so,name_en\")\n    .order(\"id\", { ascending: true });\n\n  if (subErr) throw subErr;\n\n  const categories = (cats ?? []) as CategoryRow[];\n  const subcategories = (subs ?? []) as SubcategoryRow[];\n\n  return categories.map((cat) => ({\n    ...cat,\n    subcats: subcategories.filter((s) => s.category_id === cat.id),\n  }));\n}\n\n/* =========================\n   Search page: fetch everything\n========================= */\n\nexport async function fetchAllCategories() {\n  const { data, error } = await supabase.from(\"categories\").select(\"*\").order(\"id\");\n  if (error) throw error;\n  return data ?? [];\n}\n\nexport async function fetchAllSubcategories() {\n  const { data, error } = await supabase.from(\"subcategories\").select(\"*\").order(\"id\");\n  if (error) throw error;\n  return data ?? [];\n}\n\nexport async function fetchAllProducts() {\n  const { data, error } = await supabase.from(\"products\").select(\"*\").order(\"id\");\n  if (error) throw error;\n  return data ?? [];\n}\n\nexport async function fetchAllProductVariants() {\n  const { data, error } = await supabase.from(\"product_variants\").select(\"*\").order(\"id\");\n  if (error) throw error;\n  return data ?? [];\n}\n\nexport async function fetchAllProductImages() {\n  const { data, error } = await supabase\n    .from(\"product_images\")\n    .select(\"*\")\n    .order(\"is_primary\", { ascending: false });\n  if (error) throw error;\n  return data ?? [];\n}\n\n/* =========================\n   Subcategory page helpers\n========================= */\n\nexport async function fetchSubcategoryBySlug(slug: string) {\n  const { data, error } = await supabase\n    .from(\"subcategories\")\n    .select(\"*\")\n    .eq(\"slug\", slug)\n    .maybeSingle();\n\n  if (error) {\n    console.error(\"fetchSubcategoryBySlug error:\", { slug, error });\n    throw error;\n  }\n\n  return data;\n}\nexport async function fetchBrandsByIds(ids: number[]) {\n  try {\n    const clean = Array.from(\n      new Set((ids || []).map((x) => Number(x)).filter((n) => Number.isFinite(n)))\n    );\n    if (!clean.length) return [];\n\n    const { data, error } = await supabase\n      .from(\"brands\")\n      .select(\"id,name,slug\")\n      .in(\"id\", clean)\n      .order(\"name\", { ascending: true });\n\n    if (error) {\n      console.error(\"fetchBrandsByIds error\", error);\n      return [];\n    }\n\n    return data ?? [];\n  } catch (e) {\n    console.error(\"fetchBrandsByIds exception\", e);\n    return [];\n  }\n}\n\nexport async function fetchProductBySlug(slug: string) {\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"slug\", slug)\n    .maybeSingle(); // ‚úÖ doesn't throw when 0 rows\n\n  if (error) {\n    console.error(\"fetchProductBySlug error:\", { slug, error });\n    throw error; // ‚úÖ stop masking real errors as 404\n  }\n\n  return data as ProductRow | null;\n}\n\nexport async function fetchProductsBySubcategoryId(subcategoryId: number) {\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"subcategory_id\", subcategoryId)\n    .order(\"id\", { ascending: true });\n\n  if (error) throw error;\n  return data ?? [];\n}\n\n/**\n * If you don't have subsubcategories yet, you can keep this returning []\n * OR create the table and remove the try/catch.\n */\nexport async function fetchSubSubcategoriesBySubcategoryId(subcategoryId: number) {\n  const { data, error } = await supabase\n    .from(\"subsubcategories\")\n    .select(\"*\")\n    .eq(\"subcategory_id\", subcategoryId)\n    .order(\"id\", { ascending: true });\n\n  // If the table doesn't exist yet, you can return [] instead of throwing.\n  if (error) {\n    // Uncomment next line if you prefer hard-fail:\n    // throw error;\n    return [];\n  }\n  return data ?? [];\n}\n\n/* =========================\n   Product page helpers\n========================= */\n\n\nexport async function fetchSubcategoryById(id: number) {\n  const { data, error } = await supabase.from(\"subcategories\").select(\"*\").eq(\"id\", id).single();\n  if (error) return null;\n  return data;\n}\n\n/**\n * IMPORTANT: object signature (fixes your 22P02 crash).\n */\nexport async function fetchRelatedProducts(args: {\n  subcategoryId: number;\n  excludeProductId: number;\n  limit?: number;\n}) {\n  const limit = args.limit ?? 12;\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"subcategory_id\", args.subcategoryId)\n    .neq(\"id\", args.excludeProductId)\n    .limit(limit);\n\n  if (error) throw error;\n  return data ?? [];\n}\n  \n/* =========================\n   Products / Variants / Images: by ids\n========================= */\n\nexport async function getProductsByIds(ids: number[]) {\n  const unique = Array.from(new Set(ids)).filter(Boolean);\n  if (unique.length === 0) return [];\n\n  const { data, error } = await supabase\n    .from(\"products\")\n.select(\n  \"id,name,slug,long_description,category_id,subcategory_id,brand_id,is_discounted,base_price,tags,is_active\"\n).in(\"id\", unique);\n\n  if (error) throw error;\n  return (data ?? []) as ProductRow[];\n}\n\nexport async function getVariantsByIds(ids: number[]) {\n  const unique = Array.from(new Set(ids)).filter((x) => x != null) as number[];\n  if (unique.length === 0) return [];\n\n  const { data, error } = await supabase\n    .from(\"product_variants\")\n    .select(\"id,product_id,label,price,stock\")\n    .in(\"id\", unique);\n\n  if (error) throw error;\n  return (data ?? []) as VariantRow[];\n}\n\nexport async function fetchProductsByIds(ids: number[]) {\n  // alias used by some pages\n  return getProductsByIds(ids);\n}\n\nexport async function fetchVariantsByProductIds(productIds: number[]) {\n  const unique = Array.from(new Set(productIds)).filter(Boolean);\n  if (unique.length === 0) return [];\n\n  const { data, error } = await supabase\n    .from(\"product_variants\")\n    .select(\"*\")\n    .in(\"product_id\", unique)\n    .order(\"price\", { ascending: true });\n\n  if (error) throw error;\n  return data ?? [];\n}\n\nexport async function fetchImagesByProductIds(productIds: number[]) {\n  const unique = Array.from(new Set(productIds)).filter(Boolean);\n  if (unique.length === 0) return [];\n\n  const { data, error } = await supabase\n    .from(\"product_images\")\n    .select(\"*\")\n    .in(\"product_id\", unique)\n    .order(\"is_primary\", { ascending: false });\n\n  if (error) throw error;\n  return data ?? [];\n}\n\n/* =========================\n   Single-ID wrappers (your product page imports these)\n========================= */\n\nexport async function fetchVariantsByProductId(productId: number) {\n  return fetchVariantsByProductIds([productId]);\n}\n\nexport async function fetchImagesByProductId(productId: number) {\n  return fetchImagesByProductIds([productId]);\n}\n\n/* =========================\n   Co-purchase (recommendations)\n========================= */\n\nexport async function fetchBoughtTogetherProductIds(args: {\n  productId: number;\n  limit?: number;\n  excludeIds?: number[];\n}) {\n  const limit = args.limit ?? 12;\n  const exclude = new Set([args.productId, ...(args.excludeIds ?? [])]);\n\n  const { data, error } = await supabase\n    .from(\"copurchase_counts\")\n    .select(\"co_product_id,count\")\n    .eq(\"product_id\", args.productId)\n    .order(\"count\", { ascending: false })\n    .limit(limit * 3);\n\n  if (error) throw error;\n\n  const ids: number[] = [];\n  for (const row of data ?? []) {\n    const id = Number((row as any).co_product_id);\n    if (!exclude.has(id)) ids.push(id);\n    if (ids.length >= limit) break;\n  }\n  return ids;\n}\n\n/* =========================\n   Customers (optional)\n========================= */\n\nexport async function searchCustomers(query: string) {\n  const q = query.trim();\n  if (!q) return [];\n\n  const { data, error } = await supabase\n    .from(\"customers\")\n    .select(\"id,name,phone\")\n    .or(`name.ilike.%${q}%,phone.ilike.%${q}%`)\n    .limit(8);\n\n  if (error) throw error;\n  return data ?? [];\n}\n\n/* =========================\n   Orders (checkout)\n========================= */\n\nexport async function createOrder(args: {\n  customer_id: number | null;\n  delivery: { name: string; phone: string; address: string; note?: string };\n  total_amount: number;\n}) {\n  const { data, error } = await supabase\n    .from(\"orders\")\n    .insert({\n      customer_id: args.customer_id,\n      delivery_name: args.delivery.name,\n      delivery_phone: args.delivery.phone,\n      delivery_address: args.delivery.address,\n      delivery_note: args.delivery.note ?? null,\n      total_amount: args.total_amount,\n      status: \"PENDING\",\n    })\n    .select(\"id\")\n    .single();\n\n  if (error) throw error;\n  return data as { id: number };\n}\n\nexport async function createOrderItems(\n  orderId: number,\n  items: Array<{\n    productId: number;\n    variantId: number | null;\n    qty: number;\n    priceAtPurchase: number;\n  }>\n) {\n  const payload = items.map((it) => ({\n    order_id: orderId,\n    product_id: it.productId,\n    variant_id: it.variantId,\n    quantity: it.qty,\n    price_at_purchase: it.priceAtPurchase,\n  }));\n\n  const { error } = await supabase.from(\"order_items\").insert(payload);\n\n  if (error) {\n    // helpful debugging\n    console.log(\"ORDER_ITEMS_INSERT_ERROR\", error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/checkout/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useMemo, useState, useEffect } from \"react\";\n\nimport { useCart } from \"@/context/CartContext\";\nimport { supabase } from \"@/lib/supabaseClient\";\nimport {\n  getProductsByIds,\n  getVariantsByIds,\n  createOrder,\n  createOrderItems,\n  type ProductRow,\n  type VariantRow,\n} from \"@/lib/db\";\n\ntype CartItem = { productId: number; variantId: number; qty: number };\nconst isUuid = (v: string) =>\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(v);\n\nfunction toIntArray(values: any[]): number[] {\n  const out: number[] = [];\n  for (const v of values) {\n    const n = Number(v);\n    if (Number.isFinite(n) && n > 0) out.push(Math.trunc(n));\n  }\n  return Array.from(new Set(out));\n}\n\nfunction formatMoney(n: number) {\n  return new Intl.NumberFormat(\"en-GB\", { style: \"currency\", currency: \"GBP\" }).format(\n    Number(n ?? 0)\n  );\n}\n\nexport default function CheckoutPage() {\n  const { items, clearCart } = useCart();\n  const cartItems = (Array.isArray(items) ? (items as any) : []) as CartItem[];\n\n  const [productMap, setProductMap] = useState<Record<number, ProductRow>>({});\n  const [variantMap, setVariantMap] = useState<Record<number, VariantRow>>({});\n\n  const [placing, setPlacing] = useState(false);\n  const [done, setDone] = useState(false);\n\n  // Prefilled dummy data (for fast testing)\n  const [name, setName] = useState(\"Test Customer\");\n  const [phone, setPhone] = useState(\"0622000000\");\n  const [address, setAddress] = useState(\"MATO, MOGADISHU\");\n  const [note, setNote] = useState(\"Leave at the gate (demo).\");\n\n  // Payment (Pay now vs Credit)\n  const [isCredit, setIsCredit] = useState(false);\n  const [paymentMethod, setPaymentMethod] = useState<\"EVC\" | \"CASH\" | \"MERCHANT\">(\"EVC\");\n  const [paymentRef, setPaymentRef] = useState(\"\");\n\n  useEffect(() => {\n    let alive = true;\n\n    (async () => {\n      const pids = cartItems.map((x) => x.productId);\n      const vids = cartItems\n        .map((x) => x.variantId)\n        .filter((v): v is number => v != null);\n\n      try {\n        const [ps, vs] = await Promise.all([getProductsByIds(pids), getVariantsByIds(vids)]);\n        if (!alive) return;\n\n        const pm: Record<number, ProductRow> = {};\n        for (const p of ps) pm[p.id] = p;\n\n        const vm: Record<number, VariantRow> = {};\n        for (const v of vs) vm[v.id] = v;\n\n        setProductMap(pm);\n        setVariantMap(vm);\n      } catch (e) {\n        console.error(\"CHECKOUT LOAD ERROR:\", e);\n      }\n    })();\n\n    return () => {\n      alive = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [items]);\n\n  const rows = useMemo(() => {\n    return cartItems\n      .map((ci) => {\n        const p = productMap[ci.productId];\n        if (!p) return null;\n\n        const v = ci.variantId != null ? variantMap[ci.variantId] : null;\n\n        const price = Number(v?.price ?? p.base_price ?? 0);\n        const label = v?.label ? ` (${v.label})` : \"\";\n\n        return {\n          key: `${ci.productId}-${ci.variantId ?? \"base\"}`,\n          productId: ci.productId,\n          variantId: ci.variantId ?? null,\n          name: `${p.name}${label}`,\n          qty: ci.qty ?? 1,\n          price,\n          lineTotal: price * (ci.qty ?? 1),\n        };\n      })\n      .filter(Boolean) as Array<{\n      key: string;\n      productId: number;\n      variantId: number | null;\n      name: string;\n      qty: number;\n      price: number;\n      lineTotal: number;\n    }>;\n  }, [cartItems, productMap, variantMap]);\n\n  const subtotal = useMemo(() => rows.reduce((sum, r) => sum + r.lineTotal, 0), [rows]);\n  const deliveryFee = subtotal > 0 ? 1.99 : 0;\n  const total = subtotal + deliveryFee;\n\n  async function getOrCreateCustomerId(phoneRaw: string, nameRaw: string) {\n    const phoneClean = String(phoneRaw ?? \"\").trim();\n    const nameClean = String(nameRaw ?? \"\").trim() || \"Customer\";\n\n    // 1) Try find existing customer by phone\n    const found = await supabase\n      .from(\"customers\")\n      .select(\"id\")\n      .eq(\"phone\", phoneClean)\n      .maybeSingle();\n\n    if (found.error) throw found.error;\n    if (found.data?.id) return Number(found.data.id);\n\n    // 2) Create customer\n    const created = await supabase\n      .from(\"customers\")\n      .insert({ name: nameClean, phone: phoneClean })\n      .select(\"id\")\n      .single();\n\n    if (created.error) throw created.error;\n    return Number(created.data.id);\n  }\n\n  async function placeOrder() {\n    if (cartItems.length === 0) return;\n\n    if (!name.trim() || !phone.trim() || !address.trim()) {\n      alert(\"Please fill in Name, Phone, and Address.\");\n      return;\n    }\n\n    setPlacing(true);\n\n    try {\n      // Dedup product ids for copurchase recording (as ints)\n      const productIds = toIntArray(cartItems.map((x) => x.productId));\n\n      // 1) Get/Create Customer, then Create Order\n      const customerId = await getOrCreateCustomerId(phone, name);\n\n      const order = await createOrder({\n        customer_id: customerId,\n        delivery: { name, phone, address, note },\n        total_amount: Number.isFinite(Number(total)) ? Number(total) : 0,\n      });\n\n      // 2) Create Order Items\n      const orderItemsPayload = rows.map((r) => ({\n        productId: r.productId,\n        variantId: r.variantId,\n        qty: r.qty,\n        priceAtPurchase: Number(r.price),\n      }));\n\n      await createOrderItems(order.id, orderItemsPayload);\n\n      // 2.5) If NOT credit, record payment and mark order as PAID\n      if (!isCredit) {\n        const paymentInsert = await supabase\n          .from(\"payments\")\n          .insert({\n            order_id: order.id,\n            method: paymentMethod,\n            amount: Number.isFinite(Number(total)) ? Number(total) : 0,\n            status: \"SUCCESS\",\n            reference: paymentRef.trim() ? paymentRef.trim() : null,\n          })\n          .select(\"id\")\n          .single();\n\n        if (paymentInsert.error) throw paymentInsert.error;\n\n        const upd = await supabase\n          .from(\"orders\")\n          .update({ status: \"PAID\" })\n          .eq(\"id\", order.id);\n\n        if (upd.error) throw upd.error;\n      }\n\n      // 3) Record co-purchase counts (NOT fatal if it fails)\n      // NOTE: 22P02 here is usually a type mismatch between what the RPC expects\n      // (e.g., uuid[]) and what we're sending (e.g., int[]). We try both safely.\n      try {\n        if (productIds.length >= 2) {\n          // Try int[] first\n          let { data: rpcData, error: rpcErr } = await supabase.rpc(\"record_copurchase\", {\n            product_ids: productIds,\n          });\n\n          if (rpcErr && (rpcErr as any)?.code === \"22P02\") {\n            // If your schema uses UUID ids, try sending uuid[] instead\n            const maybeUuids = cartItems\n              .map((x) => String((x as any).productId))\n              .filter((s) => isUuid(s));\n\n            if (maybeUuids.length >= 2) {\n              const retry = await supabase.rpc(\"record_copurchase\", {\n                product_ids: Array.from(new Set(maybeUuids)),\n              });\n              rpcData = retry.data;\n              rpcErr = retry.error;\n            }\n          }\n\n          if (rpcErr) {\n            console.log(\"record_copurchase rpcErr:\", rpcErr);\n            console.log(\"rpcErr.code:\", (rpcErr as any)?.code);\n            console.log(\"rpcErr.message:\", (rpcErr as any)?.message);\n            console.log(\"rpcErr.details:\", (rpcErr as any)?.details);\n            console.log(\"rpcErr.hint:\", (rpcErr as any)?.hint);\n          } else {\n            console.log(\"record_copurchase OK\", rpcData);\n          }\n        } else {\n          // Need at least 2 distinct products for co-purchase\n          console.log(\"record_copurchase skipped (need >= 2 distinct product ids)\");\n        }\n      } catch (err) {\n        console.log(\"record_copurchase threw (ignored):\", err);\n      }\n\n      clearCart();\n      setDone(true);\n    } catch (e: any) {\n      console.error(\"PLACE ORDER ERROR:\", e);\n\n      const msg =\n        e?.message ||\n        e?.error?.message ||\n        e?.details ||\n        (typeof e === \"string\" ? e : null) ||\n        JSON.stringify(e, null, 2);\n\n      if (String(msg).toLowerCase().includes(\"insufficient stock\")) {\n        alert(\n          \"Sorry ‚Äî one of the items is out of stock. Please reduce quantity or choose another size.\"\n        );\n      } else {\n        alert(`Failed to place order:\\n${msg}`);\n      }\n    } finally {\n      setPlacing(false);\n    }\n  }\n\n  return (\n    <main className=\"min-h-screen bg-white text-black\">\n      <div className=\"max-w-6xl mx-auto px-4 py-6\">\n        <div className=\"mb-4\">\n          <Link href=\"/cart\" className=\"text-sm text-blue-600 hover:underline\">\n            ‚Üê Back to cart\n          </Link>\n          <h1 className=\"text-xl font-semibold mt-2\">Checkout</h1>\n          <div className=\"text-sm text-gray-600 mt-1\">üîí Secure</div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-[1.6fr_0.9fr] gap-6\">\n          {/* LEFT */}\n          <section>\n            {done ? (\n              <div className=\"border rounded-2xl p-8 text-center\">\n                <div className=\"text-4xl\">‚úÖ</div>\n                <p className=\"text-xl font-semibold mt-3\">Order placed</p>\n                <p className=\"text-sm text-gray-600 mt-2\">\n                  Order saved to Supabase. Co-purchase counts attempted.\n                </p>\n\n                <div className=\"mt-6 flex gap-3 justify-center\">\n                  <Link\n                    href=\"/\"\n                    className=\"px-5 py-2 rounded-full bg-blue-600 text-white text-sm font-semibold\"\n                  >\n                    Continue shopping\n                  </Link>\n                  <Link\n                    href=\"/cart\"\n                    className=\"px-5 py-2 rounded-full border text-sm font-semibold\"\n                  >\n                    View cart\n                  </Link>\n                </div>\n              </div>\n            ) : (\n              <div className=\"border rounded-2xl p-5\">\n                <h2 className=\"font-semibold\">Delivery details</h2>\n                <p className=\"text-sm text-gray-600 mt-1\">Dummy data is prefilled for testing.</p>\n\n                <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <label className=\"text-sm\">\n                    Full name\n                    <input\n                      value={name}\n                      onChange={(e) => setName(e.target.value)}\n                      className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                    />\n                  </label>\n\n                  <label className=\"text-sm\">\n                    Phone number\n                    <input\n                      value={phone}\n                      onChange={(e) => setPhone(e.target.value)}\n                      className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                    />\n                  </label>\n\n                  <label className=\"text-sm md:col-span-2\">\n                    Address\n                    <input\n                      value={address}\n                      onChange={(e) => setAddress(e.target.value)}\n                      className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                    />\n                  </label>\n\n                  <label className=\"text-sm md:col-span-2\">\n                    Order note (optional)\n                    <textarea\n                      value={note}\n                      onChange={(e) => setNote(e.target.value)}\n                      rows={3}\n                      className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                    />\n                  </label>\n                </div>\n\n                <div className=\"mt-4 border rounded-xl p-3\">\n                  <div className=\"text-sm font-semibold\">Payment</div>\n\n                  <div className=\"mt-2 flex items-center gap-3\">\n                    <label className=\"text-sm flex items-center gap-2\">\n                      <input\n                        type=\"checkbox\"\n                        checked={isCredit}\n                        onChange={(e) => setIsCredit(e.target.checked)}\n                      />\n                      Credit order (mark as PENDING)\n                    </label>\n                  </div>\n\n                  <div className=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    <label className=\"text-sm\">\n                      Method\n                      <select\n                        value={paymentMethod}\n                        onChange={(e) => setPaymentMethod(e.target.value as any)}\n                        className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                        disabled={isCredit}\n                      >\n                        <option value=\"EVC\">EVC</option>\n                        <option value=\"MERCHANT\">MERCHANT</option>\n                        <option value=\"CASH\">CASH</option>\n                      </select>\n                    </label>\n\n                    <label className=\"text-sm\">\n                      Reference (optional)\n                      <input\n                        value={paymentRef}\n                        onChange={(e) => setPaymentRef(e.target.value)}\n                        className=\"mt-1 w-full border rounded-xl px-3 py-2\"\n                        placeholder=\"Txn ID / note\"\n                        disabled={isCredit}\n                      />\n                    </label>\n                  </div>\n\n                  <p className=\"text-xs text-gray-500 mt-2\">\n                    If Credit is checked, no payment row is created now (so you won‚Äôt get duplicate payments).\n                  </p>\n                </div>\n\n                <button\n                  onClick={placeOrder}\n                  disabled={placing || cartItems.length === 0}\n                  className={`mt-5 w-full rounded-full py-3 text-sm font-semibold ${\n                    placing || cartItems.length === 0\n                      ? \"bg-gray-200 text-gray-500\"\n                      : \"bg-blue-600 text-white\"\n                  }`}\n                >\n                  {placing ? \"Placing order‚Ä¶\" : isCredit ? `Create Credit Order ‚Ä¢ ${formatMoney(total)}` : `Pay Now ‚Ä¢ ${formatMoney(total)}`}\n                </button>\n\n                <p className=\"text-xs text-gray-500 mt-3\">\n                  By placing an order, you help improve ‚Äúbought together‚Äù recommendations.\n                </p>\n              </div>\n            )}\n          </section>\n\n          {/* RIGHT */}\n          <aside>\n            <div className=\"border rounded-2xl p-5 sticky top-20\">\n              <h2 className=\"font-semibold\">Order summary</h2>\n\n              <div className=\"mt-4 space-y-3\">\n                {rows.length === 0 ? (\n                  <p className=\"text-sm text-gray-600\">No items.</p>\n                ) : (\n                  rows.map((r) => (\n                    <div key={r.key} className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-700\">\n                        {r.name} √ó {r.qty}\n                      </span>\n                      <span className=\"font-semibold\">{formatMoney(r.lineTotal)}</span>\n                    </div>\n                  ))\n                )}\n              </div>\n\n              <div className=\"mt-4 border-t pt-4 space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span>Subtotal</span>\n                  <span className=\"font-semibold\">{formatMoney(subtotal)}</span>\n                </div>\n\n                <div className=\"flex justify-between\">\n                  <span>Delivery</span>\n                  <span className=\"font-semibold\">{formatMoney(deliveryFee)}</span>\n                </div>\n\n                <div className=\"flex justify-between border-t pt-3\">\n                  <span className=\"font-semibold\">Total</span>\n                  <span className=\"font-semibold\">{formatMoney(total)}</span>\n                </div>\n              </div>\n\n              <p className=\"text-xs text-gray-500 mt-3\">\n                Tip: If co-purchase RPC fails, ensure the function exists and EXECUTE is granted for\n                anon.\n              </p>\n            </div>\n          </aside>\n        </div>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}