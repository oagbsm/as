{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,8LAAY"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/admin/payments/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\ntype PaymentRow = {\n  id: number | string;\n  created_at?: string;\n  method?: string | null; // \"EVC\", \"MERCHANT\", \"CASH\", etc\n  amount?: number | string | null;\n  order_id?: number | string | null;\n};\n\nfunction money(n: any) {\n  const x = Number(n ?? 0);\n  return new Intl.NumberFormat(\"en-GB\", { style: \"currency\", currency: \"GBP\" }).format(x);\n}\n\nexport default function AdminPaymentsPage() {\n  const [loading, setLoading] = useState(true);\n  const [err, setErr] = useState<string | null>(null);\n  const [payments, setPayments] = useState<PaymentRow[]>([]);\n\n  useEffect(() => {\n    let alive = true;\n    (async () => {\n      try {\n        setLoading(true);\n        setErr(null);\n\n        const { data, error } = await supabase\n          .from(\"payments\")\n          .select(\"id,created_at,method,amount,order_id\")\n          .order(\"created_at\", { ascending: false })\n          .limit(200);\n\n        if (error) throw error;\n        if (!alive) return;\n        setPayments((data ?? []) as any);\n      } catch (e: any) {\n        if (!alive) return;\n        setErr(e?.message || \"Failed to load payments (do you have a payments table?)\");\n      } finally {\n        if (alive) setLoading(false);\n      }\n    })();\n    return () => {\n      alive = false;\n    };\n  }, []);\n\n  const totalsByMethod = useMemo(() => {\n    const map: Record<string, number> = {};\n    for (const p of payments) {\n      const k = String(p.method ?? \"UNKNOWN\").toUpperCase();\n      map[k] = (map[k] ?? 0) + Number(p.amount ?? 0);\n    }\n    return map;\n  }, [payments]);\n\n  const methods = useMemo(() => Object.keys(totalsByMethod).sort(), [totalsByMethod]);\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 text-black\">\n      <div className=\"max-w-6xl mx-auto px-4 py-6\">\n        <Link href=\"/admin\" className=\"text-sm text-blue-600 hover:underline\">\n          ← Admin\n        </Link>\n        <h1 className=\"text-xl font-semibold mt-2\">Payments</h1>\n\n        {err ? (\n          <div className=\"mt-4 border rounded-2xl p-4 bg-white text-sm text-red-600\">{err}</div>\n        ) : null}\n\n        {/* 2 cols mobile, 4 cols desktop */}\n        <section className=\"mt-4 grid grid-cols-2 lg:grid-cols-4 gap-3\">\n          {(loading ? [\"…\"] : methods).map((m, i) => (\n            <div key={m + i} className=\"border rounded-2xl p-4 bg-white\">\n              <div className=\"text-xs text-gray-500\">Method</div>\n              <div className=\"mt-1 text-sm font-semibold\">{loading ? \"…\" : m}</div>\n              <div className=\"mt-2 text-lg font-semibold\">{loading ? \"…\" : money(totalsByMethod[m])}</div>\n            </div>\n          ))}\n        </section>\n\n        <section className=\"mt-4 border rounded-2xl bg-white p-4\">\n          <div className=\"font-semibold\">Recent payments</div>\n          <div className=\"mt-3 space-y-2\">\n            {(loading ? Array.from({ length: 6 }) : payments.slice(0, 30)).map((p: any, idx) => (\n              <div key={p?.id ?? idx} className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-700\">\n                  {String(p?.method ?? \"…\")} {p?.order_id ? `• Order #${p.order_id}` : \"\"}\n                </span>\n                <span className=\"font-semibold\">{money(p?.amount)}</span>\n              </div>\n            ))}\n          </div>\n        </section>\n      </div>\n    </main>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAcA,SAAS,MAAM,CAAM;IACnB,MAAM,IAAI,OAAO,KAAK;IACtB,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QAAE,OAAO;QAAY,UAAU;IAAM,GAAG,MAAM,CAAC;AACvF;AAEe,SAAS;IACtB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAgB;IAC9C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAe,EAAE;IAEzD,IAAA,kNAAS,EAAC;QACR,IAAI,QAAQ;QACZ,CAAC;YACC,IAAI;gBACF,WAAW;gBACX,OAAO;gBAEP,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,iIAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,wCACP,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM,GACvC,KAAK,CAAC;gBAET,IAAI,OAAO,MAAM;gBACjB,IAAI,CAAC,OAAO;gBACZ,YAAa,QAAQ,EAAE;YACzB,EAAE,OAAO,GAAQ;gBACf,IAAI,CAAC,OAAO;gBACZ,OAAO,GAAG,WAAW;YACvB,SAAU;gBACR,IAAI,OAAO,WAAW;YACxB;QACF,CAAC;QACD,OAAO;YACL,QAAQ;QACV;IACF,GAAG,EAAE;IAEL,MAAM,iBAAiB,IAAA,gNAAO,EAAC;QAC7B,MAAM,MAA8B,CAAC;QACrC,KAAK,MAAM,KAAK,SAAU;YACxB,MAAM,IAAI,OAAO,EAAE,MAAM,IAAI,WAAW,WAAW;YACnD,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI,OAAO,EAAE,MAAM,IAAI;QAC9C;QACA,OAAO;IACT,GAAG;QAAC;KAAS;IAEb,MAAM,UAAU,IAAA,gNAAO,EAAC,IAAM,OAAO,IAAI,CAAC,gBAAgB,IAAI,IAAI;QAAC;KAAe;IAElF,qBACE,8OAAC;QAAK,WAAU;kBACd,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC,uKAAI;oBAAC,MAAK;oBAAS,WAAU;8BAAwC;;;;;;8BAGtE,8OAAC;oBAAG,WAAU;8BAA6B;;;;;;gBAE1C,oBACC,8OAAC;oBAAI,WAAU;8BAA6D;;;;;2BAC1E;8BAGJ,8OAAC;oBAAQ,WAAU;8BAChB,CAAC,UAAU;wBAAC;qBAAI,GAAG,OAAO,EAAE,GAAG,CAAC,CAAC,GAAG,kBACnC,8OAAC;4BAAgB,WAAU;;8CACzB,8OAAC;oCAAI,WAAU;8CAAwB;;;;;;8CACvC,8OAAC;oCAAI,WAAU;8CAA8B,UAAU,MAAM;;;;;;8CAC7D,8OAAC;oCAAI,WAAU;8CAA8B,UAAU,MAAM,MAAM,cAAc,CAAC,EAAE;;;;;;;2BAH5E,IAAI;;;;;;;;;;8BAQlB,8OAAC;oBAAQ,WAAU;;sCACjB,8OAAC;4BAAI,WAAU;sCAAgB;;;;;;sCAC/B,8OAAC;4BAAI,WAAU;sCACZ,CAAC,UAAU,MAAM,IAAI,CAAC;gCAAE,QAAQ;4BAAE,KAAK,SAAS,KAAK,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,GAAQ,oBAC1E,8OAAC;oCAAuB,WAAU;;sDAChC,8OAAC;4CAAK,WAAU;;gDACb,OAAO,GAAG,UAAU;gDAAK;gDAAE,GAAG,WAAW,CAAC,SAAS,EAAE,EAAE,QAAQ,EAAE,GAAG;;;;;;;sDAEvE,8OAAC;4CAAK,WAAU;sDAAiB,MAAM,GAAG;;;;;;;mCAJlC,GAAG,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYjC"}}]
}