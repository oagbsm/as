{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/lib/copurchase-store.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\n\nconst FILE_PATH = path.join(process.cwd(), \"data\", \"copurchase.json\");\ntype CoMap = Record<string, number>;\n\nfunction ensureFile() {\n  const dir = path.dirname(FILE_PATH);\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n  if (!fs.existsSync(FILE_PATH)) fs.writeFileSync(FILE_PATH, JSON.stringify({}, null, 2), \"utf8\");\n}\n\nfunction readMap(): CoMap {\n  ensureFile();\n  return JSON.parse(fs.readFileSync(FILE_PATH, \"utf8\") || \"{}\");\n}\n\nfunction writeMap(map: CoMap) {\n  fs.writeFileSync(FILE_PATH, JSON.stringify(map, null, 2), \"utf8\");\n}\n\nfunction pairKey(a: number, b: number) {\n  const [x, y] = [a, b].sort((m, n) => m - n);\n  return `${x}|${y}`;\n}\n\nexport function recordCoPurchase(productIds: number[]) {\n  const unique = Array.from(new Set(productIds)).filter((x) => Number.isFinite(x));\n  if (unique.length < 2) return;\n\n  const map = readMap();\n\n  for (let i = 0; i < unique.length; i++) {\n    for (let j = i + 1; j < unique.length; j++) {\n      const k = pairKey(unique[i], unique[j]);\n      map[k] = (map[k] ?? 0) + 1;\n    }\n  }\n\n  writeMap(map);\n}\n\nexport function getCartRecommendations(cartIds: number[], limit = 8) {\n  const map = readMap();\n  const cartSet = new Set(cartIds);\n  const scores: Record<number, number> = {};\n\n  for (const [key, count] of Object.entries(map)) {\n    const [aStr, bStr] = key.split(\"|\");\n    const a = Number(aStr);\n    const b = Number(bStr);\n\n    const aIn = cartSet.has(a);\n    const bIn = cartSet.has(b);\n\n    if (aIn && !bIn) scores[b] = (scores[b] ?? 0) + count;\n    if (bIn && !aIn) scores[a] = (scores[a] ?? 0) + count;\n  }\n\n  for (const id of cartSet) delete scores[id];\n\n  return Object.entries(scores)\n    .map(([id, score]) => ({ productId: Number(id), score }))\n    .sort((x, y) => y.score - x.score)\n    .slice(0, limit);\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAGnD,SAAS;IACP,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC;IACzB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,MAAM,wGAAE,CAAC,SAAS,CAAC,KAAK;QAAE,WAAW;IAAK;IAC7D,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY,wGAAE,CAAC,aAAa,CAAC,WAAW,KAAK,SAAS,CAAC,CAAC,GAAG,MAAM,IAAI;AAC1F;AAEA,SAAS;IACP;IACA,OAAO,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,WAAW,WAAW;AAC1D;AAEA,SAAS,SAAS,GAAU;IAC1B,wGAAE,CAAC,aAAa,CAAC,WAAW,KAAK,SAAS,CAAC,KAAK,MAAM,IAAI;AAC5D;AAEA,SAAS,QAAQ,CAAS,EAAE,CAAS;IACnC,MAAM,CAAC,GAAG,EAAE,GAAG;QAAC;QAAG;KAAE,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI;IACzC,OAAO,GAAG,EAAE,CAAC,EAAE,GAAG;AACpB;AAEO,SAAS,iBAAiB,UAAoB;IACnD,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI,aAAa,MAAM,CAAC,CAAC,IAAM,OAAO,QAAQ,CAAC;IAC7E,IAAI,OAAO,MAAM,GAAG,GAAG;IAEvB,MAAM,MAAM;IAEZ,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;QACtC,IAAK,IAAI,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,EAAE,IAAK;YAC1C,MAAM,IAAI,QAAQ,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE;YACtC,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI;QAC3B;IACF;IAEA,SAAS;AACX;AAEO,SAAS,uBAAuB,OAAiB,EAAE,QAAQ,CAAC;IACjE,MAAM,MAAM;IACZ,MAAM,UAAU,IAAI,IAAI;IACxB,MAAM,SAAiC,CAAC;IAExC,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,KAAM;QAC9C,MAAM,CAAC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC;QAC/B,MAAM,IAAI,OAAO;QACjB,MAAM,IAAI,OAAO;QAEjB,MAAM,MAAM,QAAQ,GAAG,CAAC;QACxB,MAAM,MAAM,QAAQ,GAAG,CAAC;QAExB,IAAI,OAAO,CAAC,KAAK,MAAM,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI;QAChD,IAAI,OAAO,CAAC,KAAK,MAAM,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI;IAClD;IAEA,KAAK,MAAM,MAAM,QAAS,OAAO,MAAM,CAAC,GAAG;IAE3C,OAAO,OAAO,OAAO,CAAC,QACnB,GAAG,CAAC,CAAC,CAAC,IAAI,MAAM,GAAK,CAAC;YAAE,WAAW,OAAO;YAAK;QAAM,CAAC,GACtD,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK,EAChC,KAAK,CAAC,GAAG;AACd"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/a./mato1/app/api/copurchase/recommend/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getCartRecommendations } from \"@/lib/copurchase-store\";\n\nexport async function POST(req: Request) {\n  const body = await req.json().catch(() => null);\n  const cartIds = Array.isArray(body?.cartIds) ? body.cartIds : [];\n  const limit = Number(body?.limit ?? 8);\n\n  const recs = getCartRecommendations(cartIds.map(Number), limit);\n  return NextResponse.json({ recs });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;IAC1C,MAAM,UAAU,MAAM,OAAO,CAAC,MAAM,WAAW,KAAK,OAAO,GAAG,EAAE;IAChE,MAAM,QAAQ,OAAO,MAAM,SAAS;IAEpC,MAAM,OAAO,IAAA,sJAAsB,EAAC,QAAQ,GAAG,CAAC,SAAS;IACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE;IAAK;AAClC"}}]
}