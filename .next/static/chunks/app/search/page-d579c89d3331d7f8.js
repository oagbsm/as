(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2959],{117:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},368:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(5155),n=r(2115),s=r(3321),i=r(8029),o=r(7270);let l="recent_searches_v1";function c(){try{return JSON.parse(localStorage.getItem(l)||"[]")}catch{return[]}}function u(e){return String(e??"").toLowerCase().trim().replace(/[-_]+/g," ").replace(/\s+/g," ")}function d(){let{lang:e}=(0,i.o)(),t=(0,n.useRef)(null),r=(0,s.useRouter)(),d=(0,s.useSearchParams)().get("tag")||"",m=!!d,[f,h]=(0,n.useState)(""),[g,p]=(0,n.useState)([]),[x,y]=(0,n.useState)([]),[b,w]=(0,n.useState)([]),[N,_]=(0,n.useState)([]),[j,v]=(0,n.useState)([]),[S,k]=(0,n.useState)([]);(0,n.useEffect)(()=>{p(c()),d&&h(d),setTimeout(()=>t.current?.focus(),50),(async()=>{let[e,t,r,a,n]=await Promise.all([(0,o.iV)(),(0,o.ii)(),(0,o.eN)(),(0,o.Xo)(),(0,o.hB)()]);y(e),w(t),_(r),v(a),k(n)})()},[d]);let I=u(m?d:f);(0,n.useMemo)(()=>{if(!I)return[];let e=N.map(e=>{let t=x.find(t=>t.id===e.category_id),r=b.find(t=>t.id===e.subcategory_id),a=u(`${t?.name_so??""} ${t?.name_en??""} ${r?.name_so??""} ${r?.name_en??""}`),n=function(e,t){let r=u(e);if(!r)return 0;let a=r.split(" ").filter(Boolean),n=u(t.name),s=u(t.slug),i=u(t.long_description),o=Array.isArray(t.tags)?t.tags.map(u).join(" "):"";if(n===r)return 1e3;if(s===r)return 950;let l=0;for(let e of a)n.includes(e)&&(l+=150),s.includes(e)&&(l+=90),o.includes(e)&&(l+=120),i.includes(e)&&(l+=20);return a[0]&&n.startsWith(a[0])&&(l+=60),l}(I,e)+30*!!I.split(" ").filter(Boolean).some(e=>a.includes(e));return n>0?{p:e,s:n}:null}).filter(Boolean);return e.sort((e,t)=>t.s-e.s),e.slice(0,30).map(e=>e.p)},[I,N,x,b]);let C=(0,n.useMemo)(()=>{if(!I)return[];let e=I.split(" ").filter(Boolean),t=new Map;return N.forEach(r=>{Array.isArray(r.tags)&&r.tags.forEach(r=>{let a=u(r),n=0;for(let t of e)a.includes(t)&&(n+=100),a.startsWith(t)&&(n+=50);n>0&&n>(t.get(r)??0)&&t.set(r,n)})}),Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e])=>e)},[I,N]);function A(e){let t=(e??f).trim();t&&(!function(e){let t=e.trim();if(!t)return;let r=[t,...c().filter(e=>e.toLowerCase()!==t.toLowerCase())].slice(0,10);localStorage.setItem(l,JSON.stringify(r))}(t),p(c()),r.push(`/search/results/${encodeURIComponent(t)}`))}return(0,n.useMemo)(()=>x.slice(0,8),[x]),(0,n.useMemo)(()=>b.slice(0,14),[b]),(0,n.useMemo)(()=>N.slice(0,10),[N]),(0,a.jsxs)("main",{className:"min-h-screen bg-white text-black pb-24",children:[(0,a.jsx)("section",{className:"px-3 pt-3 pb-2 border-b border-gray-200",children:(0,a.jsx)("div",{className:"relative max-w-md mx-auto",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),A()},className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>window.history.length>1?r.back():r.push("/"),className:"h-9 w-9 rounded-full flex items-center justify-center border border-gray-300 bg-white","aria-label":"Back",children:(0,a.jsx)("span",{className:"text-xl leading-none text-gray-700",children:"←"})}),(0,a.jsxs)("div",{className:"flex-1 h-11 rounded-full border border-[#4A6FB8] bg-white px-3 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-7 w-7 rounded-md border border-[#4A6FB8] flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lg font-extrabold text-[#4A6FB8]",children:"m"})}),(0,a.jsx)("input",{ref:t,value:f,onChange:e=>h(e.target.value),placeholder:"en"===e?"Search":"Raadi",className:"flex-1 outline-none text-base"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{h(""),m&&r.push("/search")},className:"h-9 w-9 rounded-full flex items-center justify-center border border-gray-300 bg-white","aria-label":"Clear",children:(0,a.jsx)("span",{className:"text-xl leading-none text-gray-700",children:"✕"})})]})})}),m?null:(0,a.jsx)("section",{className:"px-3 pt-4 pb-6",children:(0,a.jsx)("div",{className:"max-w-md mx-auto",children:f&&C.length>0?(0,a.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:C.map(e=>(0,a.jsxs)("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 hover:bg-gray-50 border-b last:border-b-0",onClick:()=>A(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-full border border-gray-400 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDD0D"})}),(0,a.jsx)("div",{className:"text-base text-gray-900 text-left",children:function(e,t){let r=t.trim();if(!r)return e;let n=e.toLowerCase(),s=r.toLowerCase(),i=n.indexOf(s);return -1===i?e:(0,a.jsxs)(a.Fragment,{children:[e.slice(0,i),(0,a.jsx)("span",{className:"font-semibold",children:e.slice(i,i+r.length)}),e.slice(i+r.length)]})}(e,f)})]}),(0,a.jsx)("div",{className:"text-2xl leading-none text-[#4A6FB8]",children:"→"})]},e))}):f?(0,a.jsxs)("div",{className:"bg-white border rounded-2xl p-4 text-sm text-gray-700",children:["en"===e?(0,a.jsxs)(a.Fragment,{children:["No matching tags found for ",(0,a.jsx)("b",{children:f}),".",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"block mt-2 text-gray-700",children:"Can't find what you need? We can try to source it for you."}),(0,a.jsx)("span",{className:"block mt-1 text-gray-700",children:"Do you want it yourself or know a shop that has it? Tap WhatsApp and send us details."})]}):(0,a.jsxs)(a.Fragment,{children:["Calaamado ku habboon lagama helin ",(0,a.jsx)("b",{children:f}),".",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"block mt-2 text-gray-700",children:"Ma helaysid waxaad raadineysay? Waxaan isku dayi karnaa inaan kuu soo helno."}),(0,a.jsx)("span",{className:"block mt-1 text-gray-700",children:"Adigu ma rabtaa mise qof ama dukaan ayaad taqaannaa oo haysta? Riix WhatsApp oo noogu soo dir faahfaahinta."})]}),(0,a.jsx)("a",{href:`https://wa.me/252622073874?text=${encodeURIComponent(`MatoMart - I can't find this item: "${f}". Please help me source it.`)}`,target:"_blank",rel:"noopener noreferrer",className:"mt-3 inline-flex items-center justify-center rounded-full bg-[#0B6EA9] px-4 py-2 text-sm font-semibold text-white",children:"WhatsApp"})]}):null})})]})}function m(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("main",{className:"min-h-screen bg-white text-black pb-24"}),children:(0,a.jsx)(d,{})})}},3321:(e,t,r)=>{"use strict";var a=r(4645);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},7270:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>g,HZ:()=>N,J:()=>m,TW:()=>x,Tl:()=>f,VR:()=>s,Xo:()=>c,cg:()=>b,dC:()=>d,eN:()=>l,fS:()=>w,hB:()=>u,iV:()=>i,ii:()=>o,lN:()=>n,lv:()=>y,ob:()=>h,wR:()=>p});var a=r(117);function n(e){let t=String(e??"").trim();return t&&(t.startsWith("/")||t.startsWith("http://")||t.startsWith("https://"))?t:"/example.png"}async function s(){let{data:e,error:t}=await a.N.from("categories").select("id,slug,img,name_so,name_en").order("id",{ascending:!0});if(t)throw t;let{data:r,error:n}=await a.N.from("subcategories").select("id,category_id,slug,img,name_so,name_en").order("id",{ascending:!0});if(n)throw n;let s=r??[];return(e??[]).map(e=>({...e,subcats:s.filter(t=>t.category_id===e.id)}))}async function i(){let{data:e,error:t}=await a.N.from("categories").select("*").order("id");if(t)throw t;return e??[]}async function o(){let{data:e,error:t}=await a.N.from("subcategories").select("*").order("id");if(t)throw t;return e??[]}async function l(){let{data:e,error:t}=await a.N.from("products").select("*").order("id");if(t)throw t;return e??[]}async function c(){let{data:e,error:t}=await a.N.from("product_variants").select("*").order("id");if(t)throw t;return e??[]}async function u(){let{data:e,error:t}=await a.N.from("product_images").select("*").order("is_primary",{ascending:!1});if(t)throw t;return e??[]}async function d(e){let{data:t,error:r}=await a.N.from("subcategories").select("*").eq("slug",e).maybeSingle();if(r)throw console.error("fetchSubcategoryBySlug error:",{slug:e,error:r}),r;return t}async function m(e){let{data:t,error:r}=await a.N.from("products").select("*").eq("subcategory_id",e).order("id",{ascending:!0});if(r)throw r;return t??[]}async function f(e){let{data:t,error:r}=await a.N.from("subsubcategories").select("*").eq("subcategory_id",e).order("id",{ascending:!0});return r?[]:t??[]}async function h(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:n}=await a.N.from("products").select("id,name,slug,long_description,category_id,subcategory_id,brand_id,is_discounted,base_price,tags,is_active").in("id",t);if(n)throw n;return r??[]}async function g(e){let t=Array.from(new Set(e)).filter(e=>null!=e);if(0===t.length)return[];let{data:r,error:n}=await a.N.from("product_variants").select("id,product_id,label,price,stock").in("id",t);if(n)throw n;return r??[]}async function p(e){return h(e)}async function x(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:n}=await a.N.from("product_variants").select("*").in("product_id",t).order("price",{ascending:!0});if(n)throw n;return r??[]}async function y(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:n}=await a.N.from("product_images").select("*").in("product_id",t).order("is_primary",{ascending:!1});if(n)throw n;return r??[]}async function b(e){let t=e.trim();if(!t)return[];let{data:r,error:n}=await a.N.from("customers").select("id,name,phone").or(`name.ilike.%${t}%,phone.ilike.%${t}%`).limit(8);if(n)throw n;return r??[]}async function w(e){let{data:t,error:r}=await a.N.from("orders").insert({customer_id:e.customer_id,delivery_name:e.delivery.name,delivery_phone:e.delivery.phone,delivery_address:e.delivery.address,delivery_note:e.delivery.note??null,total_amount:e.total_amount,status:"PENDING"}).select("id").single();if(r)throw r;return t}async function N(e,t){let r=t.map(t=>({order_id:e,product_id:t.productId,variant_id:t.variantId,quantity:t.qty,price_at_purchase:t.priceAtPurchase})),{error:n}=await a.N.from("order_items").insert(r);if(n)throw console.log("ORDER_ITEMS_INSERT_ERROR",n),n}},8029:(e,t,r)=>{"use strict";r.d(t,{LanguageProvider:()=>l,o:()=>c});var a=r(5155),n=r(2115);let s=(0,n.createContext)(null),i="lang_v1",o="lang";function l({children:e}){let[t,r]=(0,n.useState)("so");return(0,n.useEffect)(()=>{let e=function(e){if("undefined"==typeof document)return"";let t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):""}(o)||null,t=localStorage.getItem(i)||null;r(e||t||"so")},[]),(0,a.jsx)(s.Provider,{value:{lang:t,setLang:e=>{r(e),localStorage.setItem(i,e),function(e,t,r=365){let a=new Date;a.setTime(a.getTime()+24*r*36e5),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${a.toUTCString()}; path=/`}(o,e)}},children:e})}function c(){let e=(0,n.useContext)(s);if(!e)throw Error("useLanguage must be used within LanguageProvider");return e}},9926:(e,t,r)=>{Promise.resolve().then(r.bind(r,368))}},e=>{e.O(0,[1958,8441,3794,7358],()=>e(e.s=9926)),_N_E=e.O()}]);