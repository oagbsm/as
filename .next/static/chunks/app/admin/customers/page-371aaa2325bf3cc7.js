(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1016],{117:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},3987:(e,t,s)=>{Promise.resolve().then(s.bind(s,5825))},5825:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),r=s(8500),l=s.n(r),i=s(2115),d=s(117);let n=e=>Number.isFinite(Number(e))?Number(e):0;function c(){let[e,t]=(0,i.useState)(""),[s,r]=(0,i.useState)(!1),[c,o]=(0,i.useState)([]),[m,x]=(0,i.useState)("Test Customer"),[u,h]=(0,i.useState)("0622000000"),[p,N]=(0,i.useState)(!1);async function f(){r(!0);let t=e.trim()?await d.N.from("customers").select("id,name,phone,created_at").or(`name.ilike.%${e.trim()}%,phone.ilike.%${e.trim()}%`).order("id",{ascending:!1}).limit(200):await d.N.from("customers").select("id,name,phone,created_at").order("id",{ascending:!1}).limit(200);if(t.error){r(!1),alert(t.error.message);return}let s=t.data??[],a=s.map(e=>e.id);if(0===a.length){o([]),r(!1);return}let l=await d.N.from("orders").select("id,customer_id,total_amount,created_at").in("customer_id",a).order("created_at",{ascending:!1});if(l.error){r(!1),alert(l.error.message);return}let i=new Map;for(let e of l.data??[]){let t=e.customer_id;if(!t)continue;let s=i.get(t)??{count:0,sum:0,last:null};s.count+=1,s.sum+=n(e.total_amount),s.last||(s.last=e.created_at??null),i.set(t,s)}let c=s.map(e=>{let t=i.get(e.id);return{...e,orders_count:t?.count??0,total_spent:t?.sum??0,last_order_at:t?.last??null}});c.sort((e,t)=>t.total_spent-e.total_spent),o(c),r(!1)}(0,i.useEffect)(()=>{f()},[]);let g=(0,i.useMemo)(()=>{let t=e.trim().toLowerCase();return t?c.filter(e=>e.name.toLowerCase().includes(t)||String(e.phone??"").toLowerCase().includes(t)):c},[c,e]);async function j(){let e=m.trim(),t=u.trim();if(!e||!t)return alert("Name + phone required");N(!0);try{let{error:s}=await d.N.from("customers").insert({name:e,phone:t});if(s)throw s;x(""),h(""),await f()}catch(e){alert(e?.message||"Failed to add customer")}finally{N(!1)}}return(0,a.jsx)("main",{className:"min-h-screen bg-white text-black",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Customers"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Search, view totals, and add customers."})]}),(0,a.jsx)(l(),{href:"/admin",className:"text-sm text-blue-600 hover:underline",children:"← Back"})]}),(0,a.jsxs)("div",{className:"mt-5 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Search"}),(0,a.jsx)("input",{className:"mt-2 w-full border rounded-xl px-3 py-2 text-sm",value:e,onChange:e=>t(e.target.value),placeholder:"Search name or phone…"}),(0,a.jsx)("button",{onClick:f,className:"mt-2 w-full rounded-full bg-blue-600 text-white py-2 text-sm font-semibold",children:"Refresh"}),(0,a.jsx)("div",{className:"mt-6 font-semibold",children:"Add customer"}),(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,a.jsx)("input",{className:"w-full border rounded-xl px-3 py-2 text-sm",value:m,onChange:e=>x(e.target.value),placeholder:"Full name"}),(0,a.jsx)("input",{className:"w-full border rounded-xl px-3 py-2 text-sm",value:u,onChange:e=>h(e.target.value),placeholder:"Phone (e.g. 0622...)"}),(0,a.jsx)("button",{disabled:p,onClick:j,className:`w-full rounded-full py-2 text-sm font-semibold ${p?"bg-gray-200 text-gray-500":"bg-black text-white"}`,children:p?"Saving…":"Add"})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-2 border rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Customer list"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Showing ",g.length,s?" • loading…":""]})]}),(0,a.jsx)("div",{className:"mt-3 space-y-2",children:0===g.length?(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"No customers."}):g.map(e=>(0,a.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[e.phone," • ID #",e.id]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Total spent"}),(0,a.jsx)("div",{className:"font-semibold",children:e.total_spent.toFixed(2)})]})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-3 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"border rounded-xl p-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Orders"}),(0,a.jsx)("div",{className:"font-semibold",children:e.orders_count})]}),(0,a.jsxs)("div",{className:"border rounded-xl p-2 col-span-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Last order"}),(0,a.jsx)("div",{className:"font-semibold",children:e.last_order_at?new Date(e.last_order_at).toLocaleString():"—"})]})]}),(0,a.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:"Next: we can add “View orders” drawer + credits balance here."})]},e.id))})]})]})]})})}}},e=>{e.O(0,[8500,1958,8441,3794,7358],()=>e(e.s=3987)),_N_E=e.O()}]);