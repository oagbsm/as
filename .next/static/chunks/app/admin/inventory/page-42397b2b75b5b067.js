(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17],{117:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});let a=(0,s(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},1152:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(5155),l=s(8500),r=s.n(l),i=s(2115),d=s(117);function n(e){let t=Number(e??0);return Number.isFinite(t)?t:0}function c(e){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(n(e))}function o(){let[e,t]=(0,i.useState)(!0),[s,l]=(0,i.useState)(null),[o,m]=(0,i.useState)([]),[x,u]=(0,i.useState)({}),[h,p]=(0,i.useState)([]),[b,N]=(0,i.useState)(""),[g,j]=(0,i.useState)(null),[v,f]=(0,i.useState)(""),[y,w]=(0,i.useState)(""),[_,S]=(0,i.useState)(""),[C,k]=(0,i.useState)(""),[E,M]=(0,i.useState)(""),[$,P]=(0,i.useState)(""),[I,q]=(0,i.useState)(10),[V,R]=(0,i.useState)(0),[U,A]=(0,i.useState)(""),[B,F]=(0,i.useState)(!0),[O,H]=(0,i.useState)("EVC"),[z,D]=(0,i.useState)(0),[J,Z]=(0,i.useState)(!1),[Q,K]=(0,i.useState)(!1),[L,T]=(0,i.useState)([]),[X,Y]=(0,i.useState)([]),[G,W]=(0,i.useState)([]),[ee,et]=(0,i.useState)(!1),[es,ea]=(0,i.useState)([]),[el,er]=(0,i.useState)(!1),[ei,ed]=(0,i.useState)(null),[en,ec]=(0,i.useState)("EVC"),[eo,em]=(0,i.useState)(0),[ex,eu]=(0,i.useState)(""),[eh,ep]=(0,i.useState)(!1);async function eb(){t(!0),l(null);try{let{data:e,error:t}=await d.N.from("product_variants").select("id,product_id,label,sku,price,mrp,stock,created_at,products:products(id,name,slug)").order("id",{ascending:!0}).limit(5e3);if(t)throw t;m(e??[]);let{data:s,error:a}=await d.N.from("products").select("id,name,slug").limit(5e3);if(a)throw a;let l={};for(let e of s??[])l[Number(e.id)]=e;u(l);let{data:r,error:i}=await d.N.from("suppliers").select("id,name,phone,email,address,created_at").order("id",{ascending:!0}).limit(2e3);if(i)throw i;p(r??[]);let{data:c,error:o}=await d.N.from("inventory_batches").select("id,variant_id,supplier_id,qty_received,qty_remaining,total_cost,unit_cost,reference,received_at,is_paid,paid_amount,payment_method,payee,note").order("received_at",{ascending:!1}).limit(500);if(o)throw o;let x=(c??[]).filter(e=>n(e.total_cost)-n(e.paid_amount)>1e-4);ea(x)}catch(e){l(e?.message||"Failed to load inventory data")}finally{t(!1)}}(0,i.useEffect)(()=>{eb()},[]),(0,i.useEffect)(()=>{B?D(e=>e>0?e:n(V)):D(0)},[B,V]);let eN=(0,i.useMemo)(()=>{let e={};for(let t of h)e[t.id]=t;return e},[h]),eg=(0,i.useMemo)(()=>{let e=b.trim().toLowerCase();return e?o.filter(t=>{let s=t.products??(x[t.product_id]?{...x[t.product_id]}:null);return`${s?.name??""} ${s?.slug??""} ${t.label??""} ${t.sku??""}`.toLowerCase().includes(e)}):o},[b,o,x]),ej=(0,i.useMemo)(()=>{let e=o.length;return{totalVariants:e,low:o.filter(e=>5>=n(e.stock)).length,out:o.filter(e=>0>=n(e.stock)).length}},[o]);async function ev(){let e=v.trim();if(!e)return alert("Supplier name is required.");Z(!0);try{let{error:t}=await d.N.from("suppliers").insert({name:e,phone:y.trim()||null,email:_.trim()||null,address:C.trim()||null});if(t)throw t;f(""),w(""),S(""),k(""),await eb()}catch(e){alert(e?.message||"Failed to add supplier")}finally{Z(!1)}}async function ef(){if(!E)return alert("Choose a variant.");let e=Math.trunc(n(I)),t=n(V);if(e<=0)return alert("Quantity must be > 0.");if(t<0)return alert("Total cost must be >= 0.");if(B&&0>=n(z))return alert("Enter paid amount (or switch to Pay later).");K(!0);let s=Number(E);try{let a={variant_id:s,supplier_id:$?Number($):null,qty_received:e,qty_remaining:e,total_cost:t,reference:U.trim()||null,is_paid:!B&&!1,paid_amount:0,payment_method:B?O:null},{data:l,error:r}=await d.N.from("inventory_batches").insert(a).select("id").single();if(r)throw r;if(B){let{error:e}=await d.N.from("inventory_payments").insert({batch_id:Number(l.id),method:O,amount:n(z),status:"SUCCESS",reference:U.trim()||null});if(e)throw e}m(t=>t.map(t=>t.id===s?{...t,stock:n(t.stock)+e}:t)),A(""),await eb(),g===s&&await ey(s)}catch(e){alert(e?.message||"Failed to receive batch")}finally{K(!1)}}async function ey(e){j(e),et(!0);try{let t=await d.N.from("inventory_batches").select("id,variant_id,supplier_id,qty_received,qty_remaining,total_cost,unit_cost,reference,received_at,is_paid,paid_amount,payment_method,payee,note").eq("variant_id",e).order("received_at",{ascending:!1}).limit(50),s=await d.N.from("inventory_movements").select("id,variant_id,batch_id,type,qty,unit_cost,note,order_id,created_at").eq("variant_id",e).order("created_at",{ascending:!1}).limit(100);if(t.error)throw t.error;if(s.error)throw s.error;let a=t.data??[];T(a),Y(s.data??[]);let l=a.map(e=>Number(e.id)).filter(Boolean);if(0===l.length)W([]);else{let e=await d.N.from("inventory_payments").select("id,batch_id,method,amount,status,reference,created_at").in("batch_id",l).order("created_at",{ascending:!1}).limit(200);if(e.error)throw e.error;W(e.data??[])}}catch(e){alert(e?.message||"Failed to load details"),T([]),Y([]),W([])}finally{et(!1)}}let ew=(0,i.useMemo)(()=>g?o.find(e=>e.id===g)??null:null,[g,o]),e_=(0,i.useMemo)(()=>ew?ew.products??x[ew.product_id]??null:null,[ew,x]),eS=(0,i.useMemo)(()=>{let e=L.reduce((e,t)=>e+n(t.qty_received),0),t=L.reduce((e,t)=>e+n(t.total_cost),0);return e>0?t/e:0},[L]),eC=(0,i.useMemo)(()=>(L??[]).filter(e=>n(e.total_cost)-n(e.paid_amount)>1e-4),[L]);function ek(e){let t=Math.max(0,n(e.total_cost)-n(e.paid_amount));ed(Number(e.id)),em(t),ec(String(e.payment_method??"EVC")),eu(e.reference??""),er(!0)}async function eE(){if(!ei)return;let e=n(eo);if(e<=0)return alert("Amount must be > 0.");ep(!0);try{let{error:t}=await d.N.from("inventory_payments").insert({batch_id:ei,method:en,amount:e,status:"SUCCESS",reference:ex.trim()||null});if(t)throw t;g&&await ey(g),await eb(),er(!1),ed(null),eu("")}catch(e){alert(e?.message||"Failed to record payment")}finally{ep(!1)}}return(0,a.jsx)("main",{className:"min-h-screen bg-gray-50 text-black",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(r(),{href:"/admin",className:"text-sm text-blue-600 hover:underline",children:"← Admin"}),(0,a.jsx)("h1",{className:"text-xl font-semibold mt-2",children:"Inventory"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Stock comes from ",(0,a.jsx)("span",{className:"font-semibold",children:"product_variants.stock"}),". Batches log purchases; payments can be paid now or later."]})]}),(0,a.jsx)("button",{onClick:eb,className:"px-4 py-2 rounded-full border bg-white text-sm font-semibold",children:"Refresh"})]}),s?(0,a.jsx)("div",{className:"mt-4 border rounded-2xl p-4 bg-white text-sm text-red-600",children:s}):null,(0,a.jsxs)("section",{className:"mt-4 grid grid-cols-2 lg:grid-cols-4 gap-3",children:[(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Variants"}),(0,a.jsx)("div",{className:"mt-1 text-lg font-semibold",children:e?"…":ej.totalVariants})]}),(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Low stock (≤ 5)"}),(0,a.jsx)("div",{className:"mt-1 text-lg font-semibold",children:e?"…":ej.low})]}),(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Out of stock"}),(0,a.jsx)("div",{className:"mt-1 text-lg font-semibold",children:e?"…":ej.out})]}),(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Suppliers"}),(0,a.jsx)("div",{className:"mt-1 text-lg font-semibold",children:e?"…":h.length})]})]}),(0,a.jsxs)("section",{className:"mt-4 border rounded-2xl bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:"Unpaid supplier invoices (Pay later)"}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["When you choose ",(0,a.jsx)("span",{className:"font-semibold",children:"Pay later"}),", the invoice appears here as an unpaid batch."]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Unpaid: ",(0,a.jsx)("span",{className:"font-semibold",children:e?"…":es.length})]})]}),0===es.length?(0,a.jsx)("div",{className:"mt-3 text-sm text-gray-600",children:"No unpaid invoices."}):(0,a.jsx)("div",{className:"mt-3 grid grid-cols-1 lg:grid-cols-2 gap-2",children:es.slice(0,50).map(e=>{let t=o.find(t=>t.id===Number(e.variant_id)),s=t?.products??(t?x[t.product_id]:null),l=s?.name??"Product",r=t?`${t.label} • SKU:${t.sku}`:`Variant #${e.variant_id}`,i=e.supplier_id?eN[Number(e.supplier_id)]?.name??"Supplier":"No supplier",d=Math.max(0,n(e.total_cost)-n(e.paid_amount));return(0,a.jsxs)("div",{className:"border rounded-2xl p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-semibold",children:["Invoice (Batch) #",e.id]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[i,e.reference?` • ${e.reference}`:"",e.received_at?` • ${String(e.received_at)}`:""]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:c(d)}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"due"})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-700",children:[(0,a.jsx)("div",{className:"font-semibold",children:l}),(0,a.jsx)("div",{className:"text-gray-600",children:r})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>ey(Number(e.variant_id)),className:"px-3 py-2 rounded-full border text-xs font-semibold",children:"View movements"}),(0,a.jsx)("button",{onClick:()=>ek(e),className:"px-3 py-2 rounded-full bg-blue-600 text-white text-xs font-semibold",children:"Pay / Partial"})]})]},e.id)})})]}),(0,a.jsxs)("section",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Add supplier"}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"text-sm",children:["Name *",(0,a.jsx)("input",{value:v,onChange:e=>f(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Phone",(0,a.jsx)("input",{value:y,onChange:e=>w(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Email",(0,a.jsx)("input",{value:_,onChange:e=>S(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Address",(0,a.jsx)("input",{value:C,onChange:e=>k(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]})]}),(0,a.jsx)("button",{onClick:ev,disabled:J,className:`mt-3 w-full rounded-full py-2 text-sm font-semibold ${J?"bg-gray-200 text-gray-500":"bg-blue-600 text-white"}`,children:J?"Saving…":"Save supplier"})]}),(0,a.jsxs)("div",{className:"border rounded-2xl p-4 bg-white",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Receive stock (log a batch)"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Enter ",(0,a.jsx)("span",{className:"font-semibold",children:"qty"})," + ",(0,a.jsx)("span",{className:"font-semibold",children:"total cost"}),". Choose paid now or pay later."]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"text-sm md:col-span-2",children:["Variant *",(0,a.jsxs)("select",{value:E,onChange:e=>M(e.target.value?Number(e.target.value):""),className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",children:[(0,a.jsx)("option",{value:"",children:"Select variant…"}),o.map(e=>{let t=e.products??x[e.product_id],s=`${t?.name??`Product ${e.product_id}`} • ${e.label} • SKU:${e.sku}`;return(0,a.jsx)("option",{value:e.id,children:s},e.id)})]})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Supplier (optional)",(0,a.jsxs)("select",{value:$,onChange:e=>P(e.target.value?Number(e.target.value):""),className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",children:[(0,a.jsx)("option",{value:"",children:"None"}),h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Qty received *",(0,a.jsx)("input",{type:"number",value:I,onChange:e=>q(Number(e.target.value)),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Total cost *",(0,a.jsx)("input",{type:"number",value:V,onChange:e=>R(Number(e.target.value)),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Unit cost (auto)",(0,a.jsx)("input",{value:I>0?String(n(V)/n(I)):"0",readOnly:!0,className:"mt-1 w-full border rounded-xl px-3 py-2 bg-gray-50 text-gray-700"})]}),(0,a.jsxs)("label",{className:"text-sm md:col-span-2",children:["Reference (invoice/PO)",(0,a.jsx)("input",{value:U,onChange:e=>A(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 flex items-center justify-between border rounded-xl px-3 py-2",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Paid now?"}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"If no, it will show as unpaid and you can pay later."})]}),(0,a.jsx)("button",{type:"button",onClick:()=>F(e=>!e),className:`px-3 py-2 rounded-full text-sm font-semibold ${B?"bg-blue-600 text-white":"bg-gray-100 text-black"}`,children:B?"Yes":"No"})]}),B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{className:"text-sm",children:["Payment method",(0,a.jsxs)("select",{value:O,onChange:e=>H(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",children:[(0,a.jsx)("option",{value:"EVC",children:"EVC"}),(0,a.jsx)("option",{value:"MERCHANT",children:"Merchant"}),(0,a.jsx)("option",{value:"CASH",children:"Cash"}),(0,a.jsx)("option",{value:"eDahab",children:"eDahab"}),(0,a.jsx)("option",{value:"PREMIER",children:"Premier Bank"})]})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Paid amount",(0,a.jsx)("input",{type:"number",value:z,onChange:e=>D(Number(e.target.value)),className:"mt-1 w-full border rounded-xl px-3 py-2"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Due after this: ",(0,a.jsx)("span",{className:"font-semibold",children:c(Math.max(0,n(V)-n(z)))})]})]})]}):null]}),(0,a.jsx)("button",{onClick:ef,disabled:Q,className:`mt-3 w-full rounded-full py-2 text-sm font-semibold ${Q?"bg-gray-200 text-gray-500":"bg-blue-600 text-white"}`,children:Q?"Saving…":B?"Receive & record payment":"Receive (pay later)"})]})]}),(0,a.jsxs)("section",{className:"mt-4 border rounded-2xl bg-white p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Current stock"}),(0,a.jsx)("input",{value:b,onChange:e=>N(e.target.value),placeholder:"Search product / sku / label…",className:"w-[280px] max-w-full border rounded-full px-4 py-2 text-sm"})]}),(0,a.jsx)("div",{className:"mt-3 grid grid-cols-1 lg:grid-cols-2 gap-2",children:(e?Array.from({length:10}):eg).map((t,s)=>{if(e)return(0,a.jsxs)("div",{className:"border rounded-2xl p-3 bg-gray-50",children:[(0,a.jsx)("div",{className:"h-4 w-2/3 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"mt-2 h-3 w-1/2 bg-gray-200 rounded"})]},s);let l=t.products??x[t.product_id],r=l?.name??`Product ${t.product_id}`,i=n(t.stock);return(0,a.jsxs)("button",{onClick:()=>ey(t.id),className:"border rounded-2xl p-3 text-left hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:r}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[t.label," • SKU:",t.sku]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:`text-sm font-semibold ${i<=0?"text-red-600":i<=5?"text-orange-600":"text-black"}`,children:i}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"in stock"})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-600 flex gap-4",children:[(0,a.jsxs)("span",{children:["Price: ",(0,a.jsx)("span",{className:"font-semibold",children:c(t.price)})]}),(0,a.jsxs)("span",{children:["MRP: ",(0,a.jsx)("span",{className:"font-semibold",children:c(t.mrp)})]})]})]},t.id)})})]}),g?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-end lg:items-center justify-center p-3 z-50",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-3xl rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Variant details"}),(0,a.jsxs)("div",{className:"text-lg font-semibold",children:[e_?.name??"—"," ",(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-600",children:["• ",ew?.label??""," • SKU:",ew?.sku??""]})]}),(0,a.jsxs)("div",{className:"text-sm mt-1",children:["Stock: ",(0,a.jsx)("span",{className:"font-semibold",children:ew?n(ew.stock):"—"})," • ","Avg unit cost (from batches): ",(0,a.jsx)("span",{className:"font-semibold",children:c(eS)})]})]}),(0,a.jsx)("button",{onClick:()=>j(null),className:"px-3 py-2 rounded-full border text-sm font-semibold",children:"Close"})]}),ee?(0,a.jsx)("div",{className:"mt-4 text-sm text-gray-600",children:"Loading…"}):(0,a.jsxs)(a.Fragment,{children:[eC.length>0?(0,a.jsxs)("div",{className:"mt-4 border rounded-2xl p-3 bg-yellow-50",children:[(0,a.jsx)("div",{className:"font-semibold text-sm",children:"Unpaid / partial batches"}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:eC.slice(0,6).map(e=>{let t=Math.max(0,n(e.total_cost)-n(e.paid_amount));return(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"text-gray-700",children:["Batch #",e.id," • Due ",(0,a.jsx)("span",{className:"font-semibold",children:c(t)})]}),(0,a.jsx)("button",{onClick:()=>ek(e),className:"px-3 py-2 rounded-full bg-blue-600 text-white text-xs font-semibold",children:"Pay / Partial"})]},e.id)})})]}):null,(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"border rounded-2xl p-3",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Recent batches"}),(0,a.jsx)("div",{className:"mt-3 space-y-2 text-sm",children:0===L.length?(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"No batches."}):L.map(e=>{let t=Math.max(0,n(e.total_cost)-n(e.paid_amount));return(0,a.jsxs)("div",{className:"border rounded-xl p-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"text-gray-700",children:["+",e.qty_received," ",(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[e.supplier_id?`• ${eN[e.supplier_id]?.name??"Supplier"}`:"",e.reference?` • ${e.reference}`:""]})]}),(0,a.jsx)("div",{className:"font-semibold",children:c(e.unit_cost??n(e.total_cost)/n(e.qty_received))})]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-600 flex items-center justify-between",children:[(0,a.jsxs)("span",{children:["Cost: ",(0,a.jsx)("span",{className:"font-semibold",children:c(e.total_cost)})," • Paid:"," ",(0,a.jsx)("span",{className:"font-semibold",children:c(e.paid_amount)})," • Due:"," ",(0,a.jsx)("span",{className:"font-semibold",children:c(t)})]}),(0,a.jsx)("span",{className:"text-gray-500",children:e.payment_method?String(e.payment_method):""})]})]},e.id)})})]}),(0,a.jsxs)("div",{className:"border rounded-2xl p-3",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Movements"}),(0,a.jsx)("div",{className:"mt-3 space-y-2 text-sm",children:0===X.length?(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"No movements."}):X.map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"text-gray-700",children:[e.type," ",(0,a.jsx)("span",{className:"font-semibold",children:e.qty>0?`+${e.qty}`:`${e.qty}`}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[e.order_id?` • order #${e.order_id}`:"",e.note?` • ${e.note}`:""]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:String(e.created_at)})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"mt-4 border rounded-2xl p-3",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Inventory payments"}),(0,a.jsx)("div",{className:"mt-2 space-y-2 text-sm",children:0===G.length?(0,a.jsx)("div",{className:"text-gray-600 text-sm",children:"No payments recorded."}):G.slice(0,30).map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"text-gray-700",children:["Batch #",e.batch_id," • ",e.method," • ",(0,a.jsx)("span",{className:"font-semibold",children:c(e.amount)})," ",(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.reference?` • ${e.reference}`:""})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:String(e.created_at)})]},e.id))})]})]})]})}):null,el?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-3 z-50",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Pay inventory batch"}),(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Batch #",ei]})]}),(0,a.jsx)("button",{onClick:()=>er(!1),className:"px-3 py-2 rounded-full border text-sm font-semibold",children:"Close"})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3",children:[(0,a.jsxs)("label",{className:"text-sm",children:["Method",(0,a.jsxs)("select",{value:en,onChange:e=>ec(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",children:[(0,a.jsx)("option",{value:"EVC",children:"EVC"}),(0,a.jsx)("option",{value:"MERCHANT",children:"Merchant"}),(0,a.jsx)("option",{value:"CASH",children:"Cash"}),(0,a.jsx)("option",{value:"eDahab",children:"eDahab"}),(0,a.jsx)("option",{value:"PREMIER",children:"Premier Bank"})]})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Amount",(0,a.jsx)("input",{type:"number",value:eo,onChange:e=>em(Number(e.target.value)),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Reference (optional)",(0,a.jsx)("input",{value:ex,onChange:e=>eu(e.target.value),className:"mt-1 w-full border rounded-xl px-3 py-2"})]}),(0,a.jsx)("button",{onClick:eE,disabled:eh,className:`w-full rounded-full py-2 text-sm font-semibold ${eh?"bg-gray-200 text-gray-500":"bg-blue-600 text-white"}`,children:eh?"Saving…":"Save payment"})]})]})}):null]})})}},3448:(e,t,s)=>{Promise.resolve().then(s.bind(s,1152))}},e=>{e.O(0,[500,958,441,794,358],()=>e(e.s=3448)),_N_E=e.O()}]);