(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{117:(e,a,t)=>{"use strict";t.d(a,{N:()=>s});let s=(0,t(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},281:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i});var s=t(5155),r=t(2115),l=t(117);function c(e){return e.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function i(){let[e,a]=(0,r.useState)([]),[t,i]=(0,r.useState)([]),[d,n]=(0,r.useState)([]),[o,x]=(0,r.useState)(""),[p,m]=(0,r.useState)(""),[u,g]=(0,r.useState)(""),[h,b]=(0,r.useState)(""),[y,N]=(0,r.useState)(""),[j,f]=(0,r.useState)(!1),[v,w]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[S,_]=(0,r.useState)(!1),[I,P]=(0,r.useState)(""),[U,E]=(0,r.useState)(!0),[L,B]=(0,r.useState)(!1),[O,$]=(0,r.useState)([{label:"",price:"",mrp:"",stock:""}]),[z,J]=(0,r.useState)(""),[R,Z]=(0,r.useState)(null),[A,D]=(0,r.useState)(!1),[F,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{let[e,t,s]=await Promise.all([l.N.from("categories").select("id,name_en,slug").order("id"),l.N.from("subcategories").select("id,category_id,name_en,slug").order("id"),l.N.from("brands").select("id,name,slug").order("name")]);!e.error&&e.data&&a(e.data),!t.error&&t.data&&i(t.data),!s.error&&s.data&&n(s.data)})()},[]),(0,r.useEffect)(()=>{if(!h){j||N("");return}j||N(c(h))},[h,j]);let H=async()=>{let e=window.prompt("New brand name");if(!e)return;let a=c(e),{data:t,error:s}=await l.N.from("brands").insert({name:e,slug:a}).select("id,name,slug").single();if(s||!t){console.error(s),M({type:"error",message:"Failed to create brand. Please try again."});return}n(e=>[...e,t]),g(t.id),M({type:"success",message:`Brand "${t.name}" created.`})},Q=t.filter(e=>!o||e.category_id===Number(o)),X=async e=>{e.preventDefault(),M(null);let a=[];if(h.trim()||a.push("Product name"),y.trim()||a.push("Slug"),o||a.push("Category"),p||a.push("Subcategory"),u||a.push("Brand"),v||a.push("Base price"),a.length)return void M({type:"error",message:`Please fill in all required fields: ${a.join(", ")}.`});D(!0);try{let{data:e,error:a}=await l.N.from("products").insert({name:h,slug:y,long_description:k||"",category_id:Number(o),subcategory_id:Number(p),brand_id:Number(u),is_discounted:S,base_price:Number(v),tags:I?I.split(",").map(e=>e.trim()).filter(Boolean):null,is_active:U,is_concept:L}).select("id").single();if(a||!e){M({type:"error",message:a?.message||"Failed to create product â€“ check that category, subcategory and brand are valid."}),D(!1);return}let t=e.id,s=O.filter(e=>e.label&&e.price).map(e=>({product_id:t,label:e.label.trim(),sku:`${y}-${e.label.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-")}-${Date.now()}`,price:Number(e.price),mrp:e.mrp?Number(e.mrp):Number(e.price),stock:e.stock?Number(e.stock):0}));if(s.length>0){let{error:e}=await l.N.from("product_variants").insert(s);if(e)throw console.error(e),Error("Product created but variants insert failed")}let r=z.trim()||"";if(R){let e=R.name.split(".").pop()||"jpg",a=`products/${t}-${Date.now()}.${e}`,{data:s,error:c}=await l.N.storage.from("product-images").upload(a,R,{cacheControl:"3600",upsert:!1});if(c)throw console.error(c),Error("Product created but image upload failed");let{data:i}=l.N.storage.from("product-images").getPublicUrl(s.path);r=i.publicUrl||r}if(r){let{error:e}=await l.N.from("product_images").insert({product_id:t,url:r,is_primary:!0});if(e)throw console.error(e),Error("Product created but image insert failed")}M({type:"success",message:"Product created successfully."}),b(""),N(""),w(""),C(""),_(!1),B(!1),P(""),$([{label:"",price:"",mrp:"",stock:""}]),J(""),Z(null)}catch(e){M({type:"error",message:e?.message||"Something went wrong."})}finally{D(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 text-gray-900 px-4 py-6",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,s.jsxs)("header",{className:"mb-4 flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Add new product"}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Fill in the basic details, variants, and image. Keep it simple."})]}),(0,s.jsx)("span",{className:"text-[11px] px-2 py-1 rounded border border-gray-300 text-gray-600",children:"MatoMart \xb7 Admin"})]}),F&&(0,s.jsx)("div",{className:`mb-4 rounded border px-3 py-2 text-xs ${"success"===F.type?"border-green-500 bg-green-50 text-green-800":"border-red-500 bg-red-50 text-red-800"}`,children:F.message}),(0,s.jsxs)("form",{onSubmit:X,className:"space-y-6 text-sm",children:[(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Basic info"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Product name *"}),(0,s.jsx)("input",{value:h,onChange:e=>b(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"Baraka Corn Flakes 500g"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Slug (URL) *"}),(0,s.jsx)("input",{value:y,onChange:e=>{let a=e.target.value;N(a),f(a.trim().length>0)},className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"baraka-corn-flakes-500g"}),(0,s.jsxs)("p",{className:"text-[11px] text-gray-500",children:["/product/",y||"slug"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Long description"}),(0,s.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),rows:3,className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"Describe the product..."})]})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Category & pricing"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Category *"}),(0,s.jsxs)("select",{value:o,onChange:e=>x(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white",children:[(0,s.jsx)("option",{value:"",children:"Select"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name_en},e.id))]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Subcategory *"}),(0,s.jsxs)("select",{value:p,onChange:e=>m(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white",children:[(0,s.jsx)("option",{value:"",children:"Select"}),Q.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name_en},e.id))]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Brand *"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("select",{value:u,onChange:e=>g(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white flex-1",children:[(0,s.jsx)("option",{value:"",children:"Select"}),d.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsx)("button",{type:"button",onClick:H,className:"text-[11px] px-2 py-1 border rounded bg-white text-gray-700 hover:bg-gray-100",children:"+ New"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-4 items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Base price (USD) *"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:v,onChange:e=>w(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"3.50"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"discounted",type:"checkbox",checked:S,onChange:e=>_(e.target.checked)}),"Discounted item"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"active",type:"checkbox",checked:U,onChange:e=>E(e.target.checked)}),"Active (visible)"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"concept",type:"checkbox",checked:L,onChange:e=>B(e.target.checked)}),"Concept / import-only"]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Tags (comma separated)"}),(0,s.jsx)("input",{value:I,onChange:e=>P(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"corn flakes, breakfast, baraka"})]})]}),(0,s.jsxs)("section",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Variants"}),(0,s.jsx)("p",{className:"text-[11px] text-gray-600",children:"Add one or more variants (e.g. 500g, 1kg, 6-pack)."}),(0,s.jsxs)("div",{className:"space-y-3",children:[O.map((e,a)=>(0,s.jsxs)("div",{className:"border rounded px-3 py-2 space-y-2 bg-white",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Label"}),(0,s.jsx)("input",{value:e.label,onChange:e=>{let t=e.target.value;$(e=>{let s=[...e];return s[a]={...s[a],label:t},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"500g, 1kg, 6-pack..."})]}),O.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>{$(e=>e.filter((e,t)=>t!==a))},className:"text-[11px] text-red-600",children:"Remove"})]}),(0,s.jsxs)("div",{className:"grid gap-2 grid-cols-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Price"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:e=>{let t=e.target.value;$(e=>{let s=[...e];return s[a]={...s[a],price:t},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"3.50"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"MRP"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.mrp,onChange:e=>{let t=e.target.value;$(e=>{let s=[...e];return s[a]={...s[a],mrp:t},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"4.00"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Stock"}),(0,s.jsx)("input",{type:"number",min:"0",step:"1",value:e.stock,onChange:e=>{let t=e.target.value;$(e=>{let s=[...e];return s[a]={...s[a],stock:t},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"120"})]})]})]},a)),(0,s.jsx)("button",{type:"button",onClick:()=>$(e=>[...e,{label:"",price:"",mrp:"",stock:""}]),className:"text-[11px] px-3 py-1.5 border border-dashed rounded text-gray-700 bg-white",children:"+ Add another variant"})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Primary image"}),(0,s.jsx)("p",{className:"text-[11px] text-gray-600",children:"Upload from your computer or paste a public image URL."}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Upload from computer"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{Z(e.target.files?.[0]||null)},className:"block w-full text-xs text-gray-700"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Or paste image URL"}),(0,s.jsx)("input",{value:z,onChange:e=>J(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white w-full",placeholder:"https://.../product-images/products/example.webp"})]}),(R||z)&&(0,s.jsx)("div",{className:"border rounded px-3 py-2 bg-white flex items-center justify-center",children:(0,s.jsx)("img",{src:R?URL.createObjectURL(R):z,alt:"Preview",className:"max-h-40 object-contain",onError:e=>{e.target.style.display="none"}})})]})]}),(0,s.jsx)("div",{className:"flex justify-end pt-2",children:(0,s.jsx)("button",{type:"submit",disabled:A,className:"px-4 py-2 text-sm rounded bg-blue-600 text-white disabled:opacity-60",children:A?"Saving...":"Save product"})})]})]})})}},4011:(e,a,t)=>{Promise.resolve().then(t.bind(t,281))}},e=>{e.O(0,[1958,8441,3794,7358],()=>e(e.s=4011)),_N_E=e.O()}]);