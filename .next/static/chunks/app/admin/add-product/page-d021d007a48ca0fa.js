(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{117:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});let s=(0,a(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},281:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),r=a(2115),l=a(117);function c(e){return e.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function i(){let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)([]),[d,n]=(0,r.useState)([]),[o,x]=(0,r.useState)([]),[p,u]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[h,b]=(0,r.useState)(""),[y,N]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[k,S]=(0,r.useState)(!1),[C,_]=(0,r.useState)(""),[P,I]=(0,r.useState)(""),[U,E]=(0,r.useState)(!1),[L,$]=(0,r.useState)(""),[O,B]=(0,r.useState)(!0),[z,F]=(0,r.useState)(!1),[J,R]=(0,r.useState)([{label:"",price:"",mrp:"",stock:""}]),[Z,A]=(0,r.useState)(""),[D,M]=(0,r.useState)(null),[H,Q]=(0,r.useState)(!1),[X,V]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{let[e,a,s,r]=await Promise.all([l.N.from("categories").select("id,name_en,slug").order("id"),l.N.from("subcategories").select("id,category_id,name_en,slug").order("id"),l.N.from("subsubcategories").select("id,subcategory_id,name_en,slug").order("id"),l.N.from("brands").select("id,name,slug").order("name")]);!e.error&&e.data&&t(e.data),!a.error&&a.data&&i(a.data),!s.error&&s.data&&n(s.data),!r.error&&r.data&&x(r.data)})()},[]),(0,r.useEffect)(()=>{if(!f){k||w("");return}k||w(c(f))},[f,k]);let Y=async()=>{let e=window.prompt("New brand name");if(!e)return;let t=c(e),{data:a,error:s}=await l.N.from("brands").insert({name:e,slug:t}).select("id,name,slug").single();if(s||!a){console.error(s),V({type:"error",message:"Failed to create brand. Please try again."});return}x(e=>[...e,a]),N(a.id),V({type:"success",message:`Brand "${a.name}" created.`})},q=async()=>{if(!m)return void window.alert("Please select a subcategory first.");let e=window.prompt("New sub-subcategory name");if(!e)return;let t=c(e),{data:a,error:s}=await l.N.from("subsubcategories").insert({subcategory_id:Number(m),name_en:e,name_so:e,slug:t}).select("id,subcategory_id,name_en,slug").single();if(s||!a){console.error(s),V({type:"error",message:"Failed to create sub-subcategory. Please try again."});return}n(e=>[...e,a]),b(a.id),V({type:"success",message:`Sub-subcategory "${a.name_en}" created.`})},K=a.filter(e=>!p||e.category_id===Number(p)),T=d.filter(e=>!m||e.subcategory_id===Number(m));(0,r.useEffect)(()=>{b("")},[m]);let G=async e=>{e.preventDefault(),V(null);let t=[];if(f.trim()||t.push("Product name"),v.trim()||t.push("Slug"),p||t.push("Category"),m||t.push("Subcategory"),h||t.push("Sub-subcategory"),C||t.push("Base price"),t.length)return void V({type:"error",message:`Please fill in all required fields: ${t.join(", ")}.`});Q(!0);try{let e={name:f,slug:v,long_description:P||"",category_id:Number(p),subcategory_id:Number(m),subsubcategory_id:Number(h),is_discounted:U,base_price:Number(C),tags:L?L.split(",").map(e=>e.trim()).filter(Boolean):null,is_active:O,is_concept:z};y&&(e.brand_id=Number(y));let{data:t,error:a}=await l.N.from("products").insert(e).select("id").single();if(a||!t){V({type:"error",message:a?.message||"Failed to create product â€“ check that category, subcategory and brand are valid."}),Q(!1);return}let s=t.id,r=J.filter(e=>e.label&&e.price).map(e=>({product_id:s,label:e.label.trim(),sku:`${v}-${e.label.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-")}-${Date.now()}`,price:Number(e.price),mrp:e.mrp?Number(e.mrp):Number(e.price),stock:e.stock?Number(e.stock):0}));if(r.length>0){let{error:e}=await l.N.from("product_variants").insert(r);if(e)throw console.error(e),Error("Product created but variants insert failed")}let c=Z.trim()||"";if(D){let e=D.name.split(".").pop()||"jpg",t=`products/${s}-${Date.now()}.${e}`,{data:a,error:r}=await l.N.storage.from("product-images").upload(t,D,{cacheControl:"3600",upsert:!1});if(r)throw console.error(r),Error("Product created but image upload failed");let{data:i}=l.N.storage.from("product-images").getPublicUrl(a.path);c=i.publicUrl||c}if(c){let{error:e}=await l.N.from("product_images").insert({product_id:s,url:c,is_primary:!0});if(e)throw console.error(e),Error("Product created but image insert failed")}V({type:"success",message:"Product created successfully."}),j(""),w(""),_(""),I(""),E(!1),F(!1),$(""),R([{label:"",price:"",mrp:"",stock:""}]),A(""),M(null)}catch(e){V({type:"error",message:e?.message||"Something went wrong."})}finally{Q(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 text-gray-900 px-4 py-6",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,s.jsxs)("header",{className:"mb-4 flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Add new product"}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Fill in the basic details, variants, and image. Keep it simple."})]}),(0,s.jsx)("span",{className:"text-[11px] px-2 py-1 rounded border border-gray-300 text-gray-600",children:"MatoMart \xb7 Admin"})]}),X&&(0,s.jsx)("div",{className:`mb-4 rounded border px-3 py-2 text-xs ${"success"===X.type?"border-green-500 bg-green-50 text-green-800":"border-red-500 bg-red-50 text-red-800"}`,children:X.message}),(0,s.jsxs)("form",{onSubmit:G,className:"space-y-6 text-sm",children:[(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Basic info"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Product name *"}),(0,s.jsx)("input",{value:f,onChange:e=>j(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"Baraka Corn Flakes 500g"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Slug (URL) *"}),(0,s.jsx)("input",{value:v,onChange:e=>{let t=e.target.value;w(t),S(t.trim().length>0)},className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"baraka-corn-flakes-500g"}),(0,s.jsxs)("p",{className:"text-[11px] text-gray-500",children:["/product/",v||"slug"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Long description"}),(0,s.jsx)("textarea",{value:P,onChange:e=>I(e.target.value),rows:3,className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"Describe the product..."})]})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Category & pricing"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Category *"}),(0,s.jsxs)("select",{value:p,onChange:e=>u(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white",children:[(0,s.jsx)("option",{value:"",children:"Select"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name_en},e.id))]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Subcategory *"}),(0,s.jsxs)("select",{value:m,onChange:e=>g(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white",children:[(0,s.jsx)("option",{value:"",children:"Select"}),K.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name_en},e.id))]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Sub-subcategory *"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("select",{value:h,onChange:e=>b(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white flex-1",children:[(0,s.jsx)("option",{value:"",children:"Select"}),T.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name_en},e.id))]}),(0,s.jsx)("button",{type:"button",onClick:q,className:"text-[11px] px-2 py-1 border rounded bg-white text-gray-700 hover:bg-gray-100",children:"+ New"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Brand"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("select",{value:y,onChange:e=>N(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-sm bg-white flex-1",children:[(0,s.jsx)("option",{value:"",children:"Select"}),o.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsx)("button",{type:"button",onClick:Y,className:"text-[11px] px-2 py-1 border rounded bg-white text-gray-700 hover:bg-gray-100",children:"+ New"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-4 items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Base price (USD) *"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:C,onChange:e=>_(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"3.50"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"discounted",type:"checkbox",checked:U,onChange:e=>E(e.target.checked)}),"Discounted item"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"active",type:"checkbox",checked:O,onChange:e=>B(e.target.checked)}),"Active (visible)"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,s.jsx)("input",{id:"concept",type:"checkbox",checked:z,onChange:e=>F(e.target.checked)}),"Concept / import-only"]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Tags (comma separated)"}),(0,s.jsx)("input",{value:L,onChange:e=>$(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white",placeholder:"corn flakes, breakfast, baraka"})]})]}),(0,s.jsxs)("section",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Variants"}),(0,s.jsx)("p",{className:"text-[11px] text-gray-600",children:"Add one or more variants (e.g. 500g, 1kg, 6-pack)."}),(0,s.jsxs)("div",{className:"space-y-3",children:[J.map((e,t)=>(0,s.jsxs)("div",{className:"border rounded px-3 py-2 space-y-2 bg-white",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Label"}),(0,s.jsx)("input",{value:e.label,onChange:e=>{let a=e.target.value;R(e=>{let s=[...e];return s[t]={...s[t],label:a},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"500g, 1kg, 6-pack..."})]}),J.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>{R(e=>e.filter((e,a)=>a!==t))},className:"text-[11px] text-red-600",children:"Remove"})]}),(0,s.jsxs)("div",{className:"grid gap-2 grid-cols-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Price"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:e=>{let a=e.target.value;R(e=>{let s=[...e];return s[t]={...s[t],price:a},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"3.50"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"MRP"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.mrp,onChange:e=>{let a=e.target.value;R(e=>{let s=[...e];return s[t]={...s[t],mrp:a},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"4.00"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Stock"}),(0,s.jsx)("input",{type:"number",min:"0",step:"1",value:e.stock,onChange:e=>{let a=e.target.value;R(e=>{let s=[...e];return s[t]={...s[t],stock:a},s})},className:"border rounded px-2 py-1.5 text-xs bg-white",placeholder:"120"})]})]})]},t)),(0,s.jsx)("button",{type:"button",onClick:()=>R(e=>[...e,{label:"",price:"",mrp:"",stock:""}]),className:"text-[11px] px-3 py-1.5 border border-dashed rounded text-gray-700 bg-white",children:"+ Add another variant"})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Primary image"}),(0,s.jsx)("p",{className:"text-[11px] text-gray-600",children:"Upload from your computer or paste a public image URL."}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Upload from computer"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{M(e.target.files?.[0]||null)},className:"block w-full text-xs text-gray-700"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs text-gray-600",children:"Or paste image URL"}),(0,s.jsx)("input",{value:Z,onChange:e=>A(e.target.value),className:"border rounded px-2 py-1.5 text-sm bg-white w-full",placeholder:"https://.../product-images/products/example.webp"})]}),(D||Z)&&(0,s.jsx)("div",{className:"border rounded px-3 py-2 bg-white flex items-center justify-center",children:(0,s.jsx)("img",{src:D?URL.createObjectURL(D):Z,alt:"Preview",className:"max-h-40 object-contain",onError:e=>{e.target.style.display="none"}})})]})]}),(0,s.jsx)("div",{className:"flex justify-end pt-2",children:(0,s.jsx)("button",{type:"submit",disabled:H,className:"px-4 py-2 text-sm rounded bg-blue-600 text-white disabled:opacity-60",children:H?"Saving...":"Save product"})})]})]})})}},4011:(e,t,a)=>{Promise.resolve().then(a.bind(a,281))}},e=>{e.O(0,[1958,8441,3794,7358],()=>e(e.s=4011)),_N_E=e.O()}]);