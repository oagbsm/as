(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{117:(e,s,a)=>{"use strict";a.d(s,{N:()=>t});let t=(0,a(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},1214:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>i});var t=a(5155),r=a(2115),l=a(117);function i(){let[e,s]=(0,r.useState)([]),[a,i]=(0,r.useState)([]),[d,n]=(0,r.useState)(!1),[c,o]=(0,r.useState)({}),[m,u]=(0,r.useState)(""),[x,p]=(0,r.useState)("1"),[h,N]=(0,r.useState)("Expired"),[v,b]=(0,r.useState)("");async function f(){let[e,a,t]=await Promise.all([l.N.from("product_variants").select("id,product_id,label,stock,sku,price").order("id",{ascending:!0}),l.N.from("products").select("id,name"),l.N.from("inventory_wastage").select("id,variant_id,qty,reason,note,wastage_at").order("wastage_at",{ascending:!1}).limit(200)]);if(e.error)return alert(e.error.message);if(a.error)return alert(a.error.message);if(t.error)return alert(t.error.message);s(e.data??[]);let r={};for(let e of a.data??[])r[e.id]=e;o(r),i(t.data??[])}async function g(){if(!m)return alert("Choose a variant");let e=Math.trunc(Number.isFinite(Number(x))?Number(x):0);if(e<=0)return alert("Qty must be > 0");let{error:s}=await l.N.rpc("record_wastage",{p_variant_id:Number(m),p_qty:e,p_reason:h.trim()||"Expired",p_note:v.trim()||null});if(s)return alert(s.message);p("1"),b(""),await f()}return(0,r.useEffect)(()=>{f()},[]),(0,t.jsx)("main",{className:"min-h-screen bg-white text-black",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",children:"Wastage"}),(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Record wastage"}),(0,t.jsxs)("div",{className:"mt-3 space-y-2 text-sm",children:[(0,t.jsxs)("select",{className:"w-full border rounded-xl px-3 py-2",value:m,onChange:e=>u(e.target.value?Number(e.target.value):""),children:[(0,t.jsx)("option",{value:"",children:"Select variant…"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:["#",e.id," • ",c[e.product_id]?.name??"Product"," ",e.label?`(${e.label})`:""," • stock:",e.stock]},e.id))]}),(0,t.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:x,onChange:e=>p(e.target.value),placeholder:"Qty"}),(0,t.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:h,onChange:e=>N(e.target.value),placeholder:"Reason (Expired/Damaged/etc)"}),(0,t.jsx)("textarea",{className:"w-full border rounded-xl px-3 py-2",value:v,onChange:e=>b(e.target.value),placeholder:"Note (optional)",rows:3}),(0,t.jsx)("button",{onClick:g,className:"w-full rounded-full bg-blue-600 text-white py-2 font-semibold",children:"Record wastage (decrements stock)"})]})]}),(0,t.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Recent wastage"}),(0,t.jsx)("div",{className:"mt-3 space-y-2 text-sm",children:0===a.length?(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"No wastage recorded yet."}):a.slice(0,20).map(s=>{let a=e.find(e=>e.id===s.variant_id),r=a?c[a.product_id]?.name??"Product":"Product",l=a?.label?` (${a.label})`:"";return(0,t.jsxs)("div",{className:"flex justify-between border rounded-xl px-3 py-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold",children:[r,l]}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["Variant #",s.variant_id," • Qty: ",s.qty," • ",s.reason]}),s.note?(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s.note}):null]}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:String(s.wastage_at)})]},s.id)})}),(0,t.jsxs)("div",{className:"mt-6 border-t pt-4",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Quick stock view"}),(0,t.jsx)("div",{className:"mt-3 space-y-2 text-sm",children:e.slice(0,30).map(e=>(0,t.jsxs)("div",{className:"flex justify-between border rounded-xl px-3 py-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold",children:[c[e.product_id]?.name??"Product"," ",e.label?`(${e.label})`:""]}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["Variant #",e.id," • ",e.sku]})]}),(0,t.jsxs)("div",{className:"font-semibold",children:["stock: ",e.stock]})]},e.id))})]})]})]})]})})}},3058:(e,s,a)=>{Promise.resolve().then(a.bind(a,1214))}},e=>{e.O(0,[1958,8441,3794,7358],()=>e(e.s=3058)),_N_E=e.O()}]);