(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7575],{117:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});let r=(0,s(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},5576:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(5155),a=s(2115),l=s(8500),i=s.n(l),c=s(117);function d(e){return e.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function n(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[x,p]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[b,N]=(0,a.useState)(null),[f,y]=(0,a.useState)(""),[j,v]=(0,a.useState)(""),[_,w]=(0,a.useState)(null),[k,S]=(0,a.useState)(""),[C,E]=(0,a.useState)(""),[I,q]=(0,a.useState)(""),[L,P]=(0,a.useState)(!0),[J,O]=(0,a.useState)(!1),[Z,$]=(0,a.useState)(!1),[z,A]=(0,a.useState)(""),[F,B]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{p(!0),N(null);let[e,s,r]=await Promise.all([c.N.from("subcategories").select("id,name_en,slug").order("name_en"),c.N.from("brands").select("id,name,slug").order("name"),c.N.from("products").select("id,name,slug,base_price,category_id,subcategory_id,brand_id,is_active,is_concept,is_discounted,tags").order("id",{ascending:!0})]);!e.error&&e.data&&t(e.data),!s.error&&s.data&&l(s.data),!r.error&&r.data&&o(r.data),r.error&&N({type:"error",message:r.error.message}),p(!1)})()},[]);let H=n.filter(e=>{if(j&&e.subcategory_id!==Number(j))return!1;if(!f.trim())return!0;let t=f.toLowerCase();return e.name.toLowerCase().includes(t)||e.slug.toLowerCase().includes(t)||(e.tags||[]).some(e=>e.toLowerCase().includes(t))}),D=async e=>{w(e.id),S(e.name),E(e.slug),q(null!=e.base_price?String(e.base_price):""),P(e.is_active),O(e.is_concept),$(e.is_discounted),A((e.tags||[]).join(", "));let{data:t,error:s}=await c.N.from("product_variants").select("id,label,price,mrp,stock,sku").eq("product_id",e.id).order("id");if(s){console.error(s),B([]),N({type:"error",message:"Failed to load variants for this product."});return}let r=t?.map(e=>({id:e.id,label:e.label??"",price:null!=e.price?String(e.price):"",mrp:null!=e.mrp?String(e.mrp):"",stock:null!=e.stock?String(e.stock):"",sku:e.sku??""}))||[];0===r.length&&r.push({label:"",price:"",mrp:"",stock:"",sku:""}),B(r)},M=async e=>{if(e.preventDefault(),_){if(!k.trim()||!C.trim())return void N({type:"error",message:"Name and slug are required for the product."});m(!0),N(null);try{let{error:e}=await c.N.from("products").update({name:k.trim(),slug:d(C),base_price:I?Number(I):null,is_active:L,is_concept:J,is_discounted:Z,tags:z?z.split(",").map(e=>e.trim()).filter(Boolean):null}).eq("id",_);if(e)throw Error(e.message);o(e=>e.map(e=>e.id===_?{...e,name:k.trim(),slug:d(C),base_price:I?Number(I):null,is_active:L,is_concept:J,is_discounted:Z,tags:z?z.split(",").map(e=>e.trim()).filter(Boolean):null}:e));let t=F.filter(e=>e.label&&e.price),{error:s}=await c.N.from("product_variants").delete().eq("product_id",_);if(s)throw Error(s.message);if(t.length>0){let e=t.map((e,t)=>{let s=e.sku&&e.sku.trim()||d(e.label)||`var-${_}-${t+1}`,r=`P${_}-${s}`;return{product_id:_,label:e.label.trim(),price:Number(e.price),mrp:e.mrp?Number(e.mrp):Number(e.price),stock:e.stock?Number(e.stock):0,sku:r}}),{error:s}=await c.N.from("product_variants").insert(e);if(s)throw Error(s.message)}N({type:"success",message:"Product and variants saved."})}catch(e){console.error(e),N({type:"error",message:e?.message||"Failed to save product."})}finally{m(!1)}}},Q=async()=>{if(_&&window.confirm("Are you sure you want to delete this product and its variants/images? This cannot be undone.")){h(!0),N(null);try{let{error:e}=await c.N.from("order_items").delete().eq("product_id",_);if(e)throw Error(e.message);let{error:t}=await c.N.from("product_variants").delete().eq("product_id",_);if(t)throw Error(t.message);let{error:s}=await c.N.from("product_images").delete().eq("product_id",_);if(s)throw Error(s.message);let{error:r}=await c.N.from("products").delete().eq("id",_);if(r)throw Error(r.message);o(e=>e.filter(e=>e.id!==_)),w(null),B([]),N({type:"success",message:"Product deleted successfully."})}catch(e){console.error(e),N({type:"error",message:e?.message||"Failed to delete product."})}finally{h(!1)}}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 text-gray-900 px-4 py-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-center justify-between text-xs",children:[(0,r.jsx)(i(),{href:"/admin",className:"text-blue-600 hover:underline",children:"â† Back to admin"}),(0,r.jsx)("span",{className:"text-gray-500",children:"Products admin"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row",children:[(0,r.jsxs)("div",{className:"md:w-1/2 border rounded bg-white p-3 flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-sm font-semibold",children:"Products"}),x&&(0,r.jsx)("span",{className:"text-[11px] text-gray-500",children:"Loading..."})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 text-xs",children:[(0,r.jsx)("input",{value:f,onChange:e=>y(e.target.value),placeholder:"Search by name, slug, or tag",className:"border rounded px-2 py-1.5 text-xs"}),(0,r.jsx)("div",{className:"flex gap-2 items-center",children:(0,r.jsxs)("select",{value:j,onChange:e=>v(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-xs flex-1",children:[(0,r.jsx)("option",{value:"",children:"All subcategories"}),e.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name_en},e.id))]})})]}),(0,r.jsxs)("div",{className:"mt-2 border-t pt-2 max-h-[70vh] overflow-y-auto",children:[0===H.length&&(0,r.jsx)("div",{className:"text-[11px] text-gray-500",children:"No products found. Try clearing filters."}),(0,r.jsx)("ul",{className:"space-y-1 text-xs",children:H.map(e=>{let t=s.find(t=>t.id===e.brand_id),a=e.id===_;return(0,r.jsx)("li",{children:(0,r.jsx)("button",{type:"button",onClick:()=>D(e),className:`w-full text-left px-2 py-1.5 rounded border ${a?"border-blue-500 bg-blue-50":"border-transparent hover:border-gray-200"}`,children:(0,r.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"truncate font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-[10px] text-gray-500 truncate",children:["/product/",e.slug]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-0.5",children:[null!=e.base_price&&(0,r.jsxs)("span",{className:"text-[11px] text-gray-800",children:["$",Number(e.base_price).toFixed(2)]}),t&&(0,r.jsx)("span",{className:"text-[10px] text-gray-500",children:t.name}),(0,r.jsxs)("span",{className:"text-[9px]",children:[e.is_active?"Active":"Hidden",e.is_concept?" \xb7 Concept":""]})]})]})})},e.id)})})]})]}),(0,r.jsxs)("div",{className:"md:w-1/2 border rounded bg-white p-3 text-sm",children:[b&&(0,r.jsx)("div",{className:`mb-3 rounded border px-3 py-2 text-xs ${"success"===b.type?"border-green-500 bg-green-50 text-green-800":"border-red-500 bg-red-50 text-red-800"}`,children:b.message}),_?(0,r.jsxs)("form",{onSubmit:M,className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Edit product"}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600",children:"Name"}),(0,r.jsx)("input",{value:k,onChange:e=>S(e.target.value),className:"border rounded px-2 py-1.5 text-sm"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600",children:"Slug"}),(0,r.jsx)("input",{value:C,onChange:e=>E(e.target.value),className:"border rounded px-2 py-1.5 text-sm"}),(0,r.jsxs)("p",{className:"text-[10px] text-gray-500",children:["/product/",d(C||"slug")]})]})]}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-4 items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600",children:"Base price"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:I,onChange:e=>q(e.target.value),className:"border rounded px-2 py-1.5 text-sm"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,r.jsx)("input",{type:"checkbox",checked:L,onChange:e=>P(e.target.checked)}),"Active"]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,r.jsx)("input",{type:"checkbox",checked:Z,onChange:e=>$(e.target.checked)}),"Discounted"]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,r.jsx)("input",{type:"checkbox",checked:J,onChange:e=>O(e.target.checked)}),"Concept"]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-600",children:"Tags (comma separated)"}),(0,r.jsx)("input",{value:z,onChange:e=>A(e.target.value),className:"border rounded px-2 py-1.5 text-sm",placeholder:"breakfast, cereal, kids"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h3",{className:"text-xs font-semibold uppercase text-gray-700",children:"Variants"}),(0,r.jsx)("p",{className:"text-[11px] text-gray-600",children:"Edit prices and stock, or add new variants. Leave label/price empty to ignore a row."}),(0,r.jsx)("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto pr-1",children:F.map((e,t)=>(0,r.jsxs)("div",{className:"border rounded px-3 py-2 grid gap-2 grid-cols-4 text-xs",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1 col-span-1",children:[(0,r.jsx)("label",{className:"text-[11px] text-gray-600",children:"Label"}),(0,r.jsx)("input",{value:e.label,onChange:e=>{let s=e.target.value;B(e=>{let r=[...e];return r[t]={...r[t],label:s},r})},className:"border rounded px-2 py-1",placeholder:"500g"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-[11px] text-gray-600",children:"Price"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:e=>{let s=e.target.value;B(e=>{let r=[...e];return r[t]={...r[t],price:s},r})},className:"border rounded px-2 py-1",placeholder:"3.50"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-[11px] text-gray-600",children:"MRP"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.mrp,onChange:e=>{let s=e.target.value;B(e=>{let r=[...e];return r[t]={...r[t],mrp:s},r})},className:"border rounded px-2 py-1",placeholder:"4.00"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-[11px] text-gray-600",children:"Stock"}),(0,r.jsx)("input",{type:"number",min:"0",step:"1",value:e.stock,onChange:e=>{let s=e.target.value;B(e=>{let r=[...e];return r[t]={...r[t],stock:s},r})},className:"border rounded px-2 py-1",placeholder:"100"})]})]},t))}),(0,r.jsx)("button",{type:"button",onClick:()=>B(e=>[...e,{label:"",price:"",mrp:"",stock:"",sku:""}]),className:"text-[11px] px-3 py-1.5 border border-dashed rounded text-gray-700",children:"+ Add variant"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:Q,disabled:g,className:"px-3 py-2 text-xs rounded border border-red-500 text-red-600 disabled:opacity-60",children:g?"Deleting...":"Delete product"}),(0,r.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 text-sm rounded bg-blue-600 text-white disabled:opacity-60",children:u?"Saving...":"Save changes"})]})]}):(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Select a product on the left to edit its details and variants."})]})]})]})})}},6472:(e,t,s)=>{Promise.resolve().then(s.bind(s,5576))}},e=>{e.O(0,[8500,1958,8441,3794,7358],()=>e(e.s=6472)),_N_E=e.O()}]);