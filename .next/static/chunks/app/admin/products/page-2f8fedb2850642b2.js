(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7575],{117:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});let a=(0,t(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},5576:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(5155),r=t(2115),l=t(8500),c=t.n(l),i=t(117);function d(e){return e.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function n(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)([]),[n,x]=(0,r.useState)([]),[o,p]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[g,h]=(0,r.useState)(null),[b,N]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[v,y]=(0,r.useState)(null),[k,_]=(0,r.useState)(""),[w,S]=(0,r.useState)(""),[C,I]=(0,r.useState)(""),[E,L]=(0,r.useState)(!0),[J,O]=(0,r.useState)(!1),[P,Z]=(0,r.useState)(!1),[$,z]=(0,r.useState)(""),[q,A]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{p(!0),h(null);let[e,t,a]=await Promise.all([i.N.from("categories").select("id,name_en,slug").order("id"),i.N.from("brands").select("id,name,slug").order("name"),i.N.from("products").select("id,name,slug,base_price,category_id,subcategory_id,brand_id,is_active,is_concept,is_discounted,tags").order("id",{ascending:!0})]);!e.error&&e.data&&s(e.data),!t.error&&t.data&&l(t.data),!a.error&&a.data&&x(a.data),a.error&&h({type:"error",message:a.error.message}),p(!1)})()},[]);let B=n.filter(e=>{if(f&&e.category_id!==Number(f))return!1;if(!b.trim())return!0;let s=b.toLowerCase();return e.name.toLowerCase().includes(s)||e.slug.toLowerCase().includes(s)||(e.tags||[]).some(e=>e.toLowerCase().includes(s))}),F=async e=>{y(e.id),_(e.name),S(e.slug),I(null!=e.base_price?String(e.base_price):""),L(e.is_active),O(e.is_concept),Z(e.is_discounted),z((e.tags||[]).join(", "));let{data:s,error:t}=await i.N.from("product_variants").select("id,label,price,mrp,stock,sku").eq("product_id",e.id).order("id");if(t){console.error(t),A([]),h({type:"error",message:"Failed to load variants for this product."});return}let a=s?.map(e=>({id:e.id,label:e.label??"",price:null!=e.price?String(e.price):"",mrp:null!=e.mrp?String(e.mrp):"",stock:null!=e.stock?String(e.stock):"",sku:e.sku??""}))||[];0===a.length&&a.push({label:"",price:"",mrp:"",stock:"",sku:""}),A(a)},H=async e=>{if(e.preventDefault(),v){if(!k.trim()||!w.trim())return void h({type:"error",message:"Name and slug are required for the product."});u(!0),h(null);try{let{error:e}=await i.N.from("products").update({name:k.trim(),slug:d(w),base_price:C?Number(C):null,is_active:E,is_concept:J,is_discounted:P,tags:$?$.split(",").map(e=>e.trim()).filter(Boolean):null}).eq("id",v);if(e)throw Error(e.message);x(e=>e.map(e=>e.id===v?{...e,name:k.trim(),slug:d(w),base_price:C?Number(C):null,is_active:E,is_concept:J,is_discounted:P,tags:$?$.split(",").map(e=>e.trim()).filter(Boolean):null}:e));let s=q.filter(e=>e.label&&e.price),{error:t}=await i.N.from("product_variants").delete().eq("product_id",v);if(t)throw Error(t.message);if(s.length>0){let e=s.map((e,s)=>{let t=e.sku&&e.sku.trim()||d(e.label)||`var-${v}-${s+1}`,a=`P${v}-${t}`;return{product_id:v,label:e.label.trim(),price:Number(e.price),mrp:e.mrp?Number(e.mrp):Number(e.price),stock:e.stock?Number(e.stock):0,sku:a}}),{error:t}=await i.N.from("product_variants").insert(e);if(t)throw Error(t.message)}h({type:"success",message:"Product and variants saved."})}catch(e){console.error(e),h({type:"error",message:e?.message||"Failed to save product."})}finally{u(!1)}}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 text-gray-900 px-4 py-6",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between text-xs",children:[(0,a.jsx)(c(),{href:"/admin",className:"text-blue-600 hover:underline",children:"â† Back to admin"}),(0,a.jsx)("span",{className:"text-gray-500",children:"Products admin"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row",children:[(0,a.jsxs)("div",{className:"md:w-1/2 border rounded bg-white p-3 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-sm font-semibold",children:"Products"}),o&&(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"Loading..."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 text-xs",children:[(0,a.jsx)("input",{value:b,onChange:e=>N(e.target.value),placeholder:"Search by name, slug, or tag",className:"border rounded px-2 py-1.5 text-xs"}),(0,a.jsx)("div",{className:"flex gap-2 items-center",children:(0,a.jsxs)("select",{value:f,onChange:e=>j(e.target.value?Number(e.target.value):""),className:"border rounded px-2 py-1.5 text-xs flex-1",children:[(0,a.jsx)("option",{value:"",children:"All categories"}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name_en},e.id))]})})]}),(0,a.jsxs)("div",{className:"mt-2 border-t pt-2 max-h-[70vh] overflow-y-auto",children:[0===B.length&&(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:"No products found. Try clearing filters."}),(0,a.jsx)("ul",{className:"space-y-1 text-xs",children:B.map(e=>{let s=t.find(s=>s.id===e.brand_id),r=e.id===v;return(0,a.jsx)("li",{children:(0,a.jsx)("button",{type:"button",onClick:()=>F(e),className:`w-full text-left px-2 py-1.5 rounded border ${r?"border-blue-500 bg-blue-50":"border-transparent hover:border-gray-200"}`,children:(0,a.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"truncate font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-[10px] text-gray-500 truncate",children:["/product/",e.slug]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-0.5",children:[null!=e.base_price&&(0,a.jsxs)("span",{className:"text-[11px] text-gray-800",children:["$",Number(e.base_price).toFixed(2)]}),s&&(0,a.jsx)("span",{className:"text-[10px] text-gray-500",children:s.name}),(0,a.jsxs)("span",{className:"text-[9px]",children:[e.is_active?"Active":"Hidden",e.is_concept?" \xb7 Concept":""]})]})]})})},e.id)})})]})]}),(0,a.jsxs)("div",{className:"md:w-1/2 border rounded bg-white p-3 text-sm",children:[g&&(0,a.jsx)("div",{className:`mb-3 rounded border px-3 py-2 text-xs ${"success"===g.type?"border-green-500 bg-green-50 text-green-800":"border-red-500 bg-red-50 text-red-800"}`,children:g.message}),v?(0,a.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xs font-semibold uppercase text-gray-700",children:"Edit product"}),(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Name"}),(0,a.jsx)("input",{value:k,onChange:e=>_(e.target.value),className:"border rounded px-2 py-1.5 text-sm"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Slug"}),(0,a.jsx)("input",{value:w,onChange:e=>S(e.target.value),className:"border rounded px-2 py-1.5 text-sm"}),(0,a.jsxs)("p",{className:"text-[10px] text-gray-500",children:["/product/",d(w||"slug")]})]})]}),(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-4 items-center",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Base price"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:C,onChange:e=>I(e.target.value),className:"border rounded px-2 py-1.5 text-sm"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,a.jsx)("input",{type:"checkbox",checked:E,onChange:e=>L(e.target.checked)}),"Active"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,a.jsx)("input",{type:"checkbox",checked:P,onChange:e=>Z(e.target.checked)}),"Discounted"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[(0,a.jsx)("input",{type:"checkbox",checked:J,onChange:e=>O(e.target.checked)}),"Concept"]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Tags (comma separated)"}),(0,a.jsx)("input",{value:$,onChange:e=>z(e.target.value),className:"border rounded px-2 py-1.5 text-sm",placeholder:"breakfast, cereal, kids"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"text-xs font-semibold uppercase text-gray-700",children:"Variants"}),(0,a.jsx)("p",{className:"text-[11px] text-gray-600",children:"Edit prices and stock, or add new variants. Leave label/price empty to ignore a row."}),(0,a.jsx)("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto pr-1",children:q.map((e,s)=>(0,a.jsxs)("div",{className:"border rounded px-3 py-2 grid gap-2 grid-cols-4 text-xs",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1 col-span-1",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-600",children:"Label"}),(0,a.jsx)("input",{value:e.label,onChange:e=>{let t=e.target.value;A(e=>{let a=[...e];return a[s]={...a[s],label:t},a})},className:"border rounded px-2 py-1",placeholder:"500g"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-600",children:"Price"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:e=>{let t=e.target.value;A(e=>{let a=[...e];return a[s]={...a[s],price:t},a})},className:"border rounded px-2 py-1",placeholder:"3.50"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-600",children:"MRP"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.mrp,onChange:e=>{let t=e.target.value;A(e=>{let a=[...e];return a[s]={...a[s],mrp:t},a})},className:"border rounded px-2 py-1",placeholder:"4.00"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-600",children:"Stock"}),(0,a.jsx)("input",{type:"number",min:"0",step:"1",value:e.stock,onChange:e=>{let t=e.target.value;A(e=>{let a=[...e];return a[s]={...a[s],stock:t},a})},className:"border rounded px-2 py-1",placeholder:"100"})]})]},s))}),(0,a.jsx)("button",{type:"button",onClick:()=>A(e=>[...e,{label:"",price:"",mrp:"",stock:"",sku:""}]),className:"text-[11px] px-3 py-1.5 border border-dashed rounded text-gray-700",children:"+ Add variant"})]}),(0,a.jsx)("div",{className:"flex justify-end pt-2",children:(0,a.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm rounded bg-blue-600 text-white disabled:opacity-60",children:m?"Saving...":"Save changes"})})]}):(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Select a product on the left to edit its details and variants."})]})]})]})})}},6472:(e,s,t)=>{Promise.resolve().then(t.bind(t,5576))}},e=>{e.O(0,[8500,1958,8441,3794,7358],()=>e(e.s=6472)),_N_E=e.O()}]);