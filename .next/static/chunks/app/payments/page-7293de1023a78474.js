(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{4511:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var l=s(5155),r=s(8500),a=s.n(r),d=s(2115),n=s(4835);function i(e){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e)}let c=["EVC","MERCHANT","EDAHAB","PREMIER_WALLET","AMTEL"];function o(e){return"EVC"===e?"EVC":"MERCHANT"===e?"Merchant":"EDAHAB"===e?"E-Dahab":"PREMIER_WALLET"===e?"Premier Wallet":"Amtel"}function m(){let[e,t]=(0,d.useState)([]),[s,r]=(0,d.useState)("ALL"),[m,x]=(0,d.useState)(""),[u,h]=(0,d.useState)(!1);function b(){t((0,n.u1)())}(0,d.useEffect)(()=>{b()},[]);let p=(0,d.useMemo)(()=>{let t={};for(let e of c)t[e]=0;let s=0,l=0,r={};for(let e of c)r[e]=0;for(let a of e){let e=Number(a.amount||0);s+=e,t[a.method]=(t[a.method]??0)+e,("CREDIT_PAYMENT"===a.source||"CREDIT_SETTLEMENT"===a.source)&&(l+=e,r[a.method]=(r[a.method]??0)+e)}return{all:s,byMethod:t,creditPaidAll:l,creditPaidByMethod:r}},[e]),N=(0,d.useMemo)(()=>{let t=e;"ALL"!==s&&(t=t.filter(e=>e.method===s));let l=m.trim().toLowerCase();return l?t.filter(e=>{let t=(e.id??"").toLowerCase(),s=(e.orderId??"").toLowerCase(),r=(e.customer?.name??"").toLowerCase(),a=String(e.customer?.phone??"").toLowerCase(),d=(e.note??"").toLowerCase(),n=(e.source??"").toLowerCase();return t.includes(l)||s.includes(l)||r.includes(l)||a.includes(l)||d.includes(l)||n.includes(l)}):t},[e,s,m]);return(0,l.jsxs)("main",{className:"min-h-screen bg-white text-black",children:[(0,l.jsx)("div",{className:"sticky top-0 z-20 bg-white border-b",children:(0,l.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(a(),{href:"/",className:"text-sm text-blue-600 hover:underline",children:"← Home"}),(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Payments"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(a(),{href:"/orders",className:"h-9 px-3 rounded-full border text-sm font-semibold hover:bg-gray-50",children:"Orders"}),(0,l.jsx)(a(),{href:"/credits",className:"h-9 px-3 rounded-full border text-sm font-semibold hover:bg-gray-50",children:"Credits"}),(0,l.jsx)("button",{onClick:b,className:"h-9 px-3 rounded-full border text-sm font-semibold hover:bg-gray-50",children:"Refresh"}),(0,l.jsx)("button",{onClick:()=>h(!0),className:"h-9 px-3 rounded-full border text-sm font-semibold text-red-600 hover:bg-red-50",children:"Clear"})]})]})}),(0,l.jsxs)("section",{className:"max-w-6xl mx-auto px-4 pt-5",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,l.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600",children:"All payments (total)"}),(0,l.jsx)("div",{className:"mt-1 text-2xl font-extrabold",children:i(p.all)}),(0,l.jsxs)("div",{className:"mt-1 text-sm text-gray-700",children:[e.length," record(s)"]})]}),(0,l.jsxs)("div",{className:"border rounded-2xl p-4 bg-[#FFF7ED]",children:[(0,l.jsx)("div",{className:"text-xs text-orange-800",children:"Credits paid (total)"}),(0,l.jsx)("div",{className:"mt-1 text-2xl font-extrabold text-orange-900",children:i(p.creditPaidAll)}),(0,l.jsx)("div",{className:"mt-1 text-sm text-orange-900",children:"Includes partial payments + settlements"})]}),(0,l.jsxs)("div",{className:"border rounded-2xl p-4",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600",children:"Search payments"}),(0,l.jsx)("input",{value:m,onChange:e=>x(e.target.value),placeholder:"Search: name, phone, order id, credit, PAY-...",className:"mt-2 w-full border rounded-xl px-3 py-2"})]})]}),(0,l.jsxs)("div",{className:"mt-4 border rounded-2xl p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"font-semibold",children:"Totals by payment method"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"Click a method to see its history"})]}),(0,l.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,l.jsxs)("button",{onClick:()=>r("ALL"),className:`h-9 px-4 rounded-full border text-sm font-semibold ${"ALL"===s?"border-[#0B6EA9] bg-[#EAF4FB] text-[#0B6EA9]":"bg-white"}`,children:["All (",i(p.all),")"]}),c.map(e=>{let t=s===e,a=p.byMethod[e]??0,d=p.creditPaidByMethod[e]??0;return(0,l.jsxs)("button",{onClick:()=>r(e),className:`h-9 px-4 rounded-full border text-sm font-semibold ${t?"border-[#0B6EA9] bg-[#EAF4FB] text-[#0B6EA9]":"bg-white"}`,title:`Credits paid via ${o(e)}: ${i(d)}`,children:[o(e),": ",i(a),(0,l.jsxs)("span",{className:"ml-2 text-xs opacity-70",children:["(credit ",i(d),")"]})]},e)})]})]})]}),(0,l.jsx)("section",{className:"max-w-6xl mx-auto px-4 py-6",children:0===N.length?(0,l.jsxs)("div",{className:"border rounded-2xl p-8 text-center",children:[(0,l.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCB3"}),(0,l.jsx)("p",{className:"mt-3 font-semibold",children:"No payments found"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Payments appear when you checkout paid orders or receive credit payments."})]}):(0,l.jsx)("div",{className:"space-y-3",children:N.map(e=>{var t;let s=new Date(e.createdAt).toLocaleString(),r="SALE"===(t=e.source)?{text:"SALE",cls:"bg-green-100 text-green-700"}:"CREDIT_PAYMENT"===t?{text:"CREDIT PAY",cls:"bg-orange-100 text-orange-800"}:{text:"CREDIT SETTLE",cls:"bg-blue-100 text-blue-800"},a=e.customer?`${e.customer.name} • ${e.customer.phone}`:"—";return(0,l.jsx)("div",{className:"border rounded-2xl p-4",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"text-sm font-semibold",children:[o(e.method)," • ",i(e.amount)]}),(0,l.jsx)("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${r.cls}`,children:r.text})]}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-gray-600",children:[e.id," • ",s]}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-700",children:["Customer: ",(0,l.jsx)("span",{className:"font-semibold",children:a})]}),e.orderId?(0,l.jsxs)("div",{className:"mt-1 text-xs text-gray-700",children:["Order: ",(0,l.jsx)("span",{className:"font-semibold",children:e.orderId})]}):null,e.note?(0,l.jsxs)("div",{className:"mt-1 text-xs text-gray-600",children:["Note: ",(0,l.jsx)("span",{className:"text-gray-800",children:e.note})]}):null]}),(0,l.jsxs)("div",{className:"text-right text-xs text-gray-500",children:["CREDIT_PAYMENT"===e.source?"Partial/Full credit payment":null,"CREDIT_SETTLEMENT"===e.source?"Credit order marked paid":null,"SALE"===e.source?"Normal paid sale":null]})]})},e.id)})})}),u?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/30 z-50 grid place-items-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-md p-5 border shadow",children:[(0,l.jsx)("div",{className:"text-lg font-semibold",children:"Clear payment ledger?"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"This deletes the saved payments history from this device only (testing mode)."}),(0,l.jsxs)("div",{className:"mt-5 flex gap-2 justify-end",children:[(0,l.jsx)("button",{onClick:()=>h(!1),className:"h-10 px-4 rounded-full border font-semibold",children:"Cancel"}),(0,l.jsx)("button",{onClick:function(){(0,n.l0)(),t([]),h(!1)},className:"h-10 px-4 rounded-full bg-red-600 text-white font-semibold",children:"Yes, clear"})]})]})}):null]})}},4835:(e,t,s)=>{"use strict";s.d(t,{ES:()=>a,l0:()=>d,u1:()=>r});let l="payments_ledger_v1";function r(){try{return JSON.parse(localStorage.getItem(l)||"[]")}catch{return[]}}function a(e){let t=r();t.unshift({id:`PAY-${Date.now()}`,createdAt:new Date().toISOString(),...e,amount:Number(e.amount||0)}),localStorage.setItem(l,JSON.stringify(t))}function d(){localStorage.removeItem(l)}},9391:(e,t,s)=>{Promise.resolve().then(s.bind(s,4511))}},e=>{e.O(0,[500,441,794,358],()=>e(e.s=9391)),_N_E=e.O()}]);