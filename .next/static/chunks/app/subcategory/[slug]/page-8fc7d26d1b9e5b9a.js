(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{117:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});let n=(0,r(1958).UU)("https://ecfxrmhrfjqdmqewzrfz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZnhybWhyZmpxZG1xZXd6cmZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNDA0OTgsImV4cCI6MjA4MTkxNjQ5OH0.jtF3Qp9N7rH-KCWEMHU0atH7h-LQEJBKYO9Q2HdxkX0")},2642:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(5155),a=r(5772),i=r(8500),s=r.n(i),l=r(2115),d=r(3321),o=r(8561),c=r(8029),u=r(7270);function m(e){return`₹${Number(e??0).toFixed(0)}`}function x(e,t){let r=e?.name_so??e?.name??"",n=e?.name_en??e?.name??"";return"en"===t?n:r}function h(e,t){let r=e?.name_so??e?.name??"",n=e?.name_en??e?.name??"";return"en"===t?r:n}function f(e){return String(e??"").toLowerCase().trim().replace(/[-_]+/g," ").replace(/\s+/g," ")}function g(){let{slug:e}=(0,d.useParams)(),{items:t,addItem:r,setQty:i}=(0,o._)(),{lang:g}=(0,c.o)(),[p,b]=(0,l.useState)(!0),[y,N]=(0,l.useState)(null),[w,v]=(0,l.useState)([]),[j,_]=(0,l.useState)([]),[I,S]=(0,l.useState)([]),[E,A]=(0,l.useState)([]),[C,k]=(0,l.useState)(null),[B,P]=(0,l.useState)({}),[F,R]=(0,l.useState)(null);(0,l.useEffect)(()=>{b(!0),(async()=>{let t=await (0,u.dC)(String(e));if(!t){N(null),v([]),_([]),S([]),A([]),b(!1);return}let r=await (0,u.J)(t.id),n=r.map(e=>e.id),[a,i,s]=await Promise.all([(0,u.Tl)(t.id),(0,u.TW)(n),(0,u.lv)(n)]);N(t),v(a),_(r),S(i),A(s),b(!1)})()},[e]),(0,l.useEffect)(()=>{if(null===F)return;let e=setTimeout(()=>R(null),900);return()=>clearTimeout(e)},[F]);let $=e=>I.filter(t=>t.product_id===e).slice().sort((e,t)=>e.price-t.price),q=e=>{let t=$(e);return t.length?t[0].id:null},O=(e,t)=>null==t?null:I.find(r=>r.product_id===e&&r.id===t)||null,T=(e,t,r)=>{if(null==t)return Number(r??0);let n=O(e,t);return Number(n?.price??r??0)};if(!p&&!y)return(0,n.jsx)("main",{className:"min-h-screen bg-white p-6 text-black",children:"Subcategory not found."});let J=(0,l.useMemo)(()=>j.filter(e=>e.subcategory_id===y?.id),[j,y?.id]),W=(0,l.useMemo)(()=>{if(!C)return J;let e=w.find(e=>e.slug===C),t=f(C),r=f(e?.name??e?.name_en??e?.name_so??"");return J.filter(e=>{let n=(Array.isArray(e.tags)?e.tags:[]).map(f);return n.includes(t)||r&&n.includes(r)})},[C,J,w]);(0,l.useEffect)(()=>{P(e=>{let t={...e};for(let e of W)void 0===t[e.id]&&(t[e.id]=q(e.id));return t})},[W.length,I.length]);let M=C?w.find(e=>e.slug===C):null,D=M?x(M,g):x(y,g),U=M?h(M,g):h(y,g),Z=(0,l.useMemo)(()=>{let e=0,r=0;for(let n of t??[]){let t=j.find(e=>e.id===n.productId);t&&(e+=T(n.productId,n.variantId??null,t.base_price)*(n.qty??1),r+=n.qty??1)}return{total:e,count:r}},[t,j]);function L({productId:e,basePrice:a,selectedVariantId:s}){let l=(t??[]).find(t=>t.productId===e&&(t.variantId??null)===(s??null)),d=l?.qty??0;return l?(0,n.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,n.jsx)("button",{onClick:()=>i(e,s,d-1),className:"w-10 h-10 rounded-full bg-[#0B6EA9] text-white text-xl font-bold grid place-items-center",children:"−"}),(0,n.jsx)("div",{className:"text-sm font-extrabold text-gray-900",children:d}),(0,n.jsx)("button",{onClick:()=>i(e,s,d+1),className:"w-10 h-10 rounded-full bg-[#0B6EA9] text-white text-xl font-bold grid place-items-center",children:"+"})]}):(0,n.jsxs)("button",{onClick:()=>{r(e,s,1),R(e)},className:"mt-2 w-full h-10 rounded-xl border-2 border-[#0B6EA9] text-[#0B6EA9] font-bold flex items-center justify-center gap-2 active:scale-[0.99] transition",children:["en"===g?"Add":"Ku dar"," ",(0,n.jsx)("span",{className:"text-xl leading-none",children:"+"})]})}let z=w.length>0;return(0,n.jsxs)("main",{className:"min-h-screen bg-[#F4F6F8] pb-28",children:[(0,n.jsxs)("section",{className:"bg-white border-b",children:[(0,n.jsxs)("div",{className:"mx-auto max-w-md px-4 py-3 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"leading-tight",children:[(0,n.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:p?"...":D}),(0,n.jsx)("div",{className:"text-[11px] text-gray-500",children:p?"":U})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{className:"h-9 px-3 rounded-full border text-sm bg-white flex items-center gap-2",children:["↕ ","en"===g?"Sort":"Kala saar"]}),(0,n.jsxs)("button",{className:"h-9 px-3 rounded-full border text-sm bg-white flex items-center gap-2",children:["⚙ ","en"===g?"Filter":"Shaandhee"]})]})]}),(0,n.jsxs)("div",{className:"mx-auto max-w-md px-4 pb-3 flex gap-2 overflow-x-auto",children:[(0,n.jsxs)("button",{className:"h-8 px-3 rounded-full bg-gray-100 text-xs whitespace-nowrap flex items-center gap-2",children:["↕ ","en"===g?"By Popularity":"Caannimo"," ▾"]}),(0,n.jsxs)("button",{className:"h-8 px-3 rounded-full bg-gray-100 text-xs whitespace-nowrap",children:["en"===g?"Brands":"Summado"," ▾"]}),(0,n.jsxs)("button",{className:"h-8 px-3 rounded-full bg-gray-100 text-xs whitespace-nowrap",children:["en"===g?"Filters":"Shaandheyn"," ▾"]})]})]}),(0,n.jsxs)("section",{className:`mx-auto max-w-md grid ${z?"grid-cols-[96px_1fr]":"grid-cols-1"}`,children:[z&&(0,n.jsxs)("aside",{className:"bg-white border-r",children:[(0,n.jsxs)("button",{onClick:()=>k(null),className:`w-full block px-2 py-3 border-l-4 ${null===C?"border-[#0B6EA9] bg-[#EAF4FB]":"border-transparent"}`,children:[(0,n.jsx)("div",{className:"w-12 h-12 mx-auto rounded-xl bg-gray-100 overflow-hidden grid place-items-center",children:(0,n.jsx)("span",{className:"text-[11px] font-extrabold text-gray-700",children:"en"===g?"All":"Dhammaan"})}),(0,n.jsxs)("div",{className:`mt-2 text-[11px] text-center ${null===C?"text-[#0B6EA9] font-semibold":"text-gray-700"}`,children:[(0,n.jsx)("div",{children:"en"===g?"All":"Dhammaan"}),(0,n.jsx)("div",{className:"text-[9px] text-gray-500",children:"en"===g?"Dhammaan":"All"})]})]}),w.map(e=>{let t=C===e.slug,r=x(e,g),a=h(e,g);return(0,n.jsxs)("button",{onClick:()=>k(e.slug),className:`w-full block px-2 py-3 border-l-4 ${t?"border-[#0B6EA9] bg-[#EAF4FB]":"border-transparent"}`,children:[(0,n.jsx)("div",{className:"w-12 h-12 mx-auto rounded-xl bg-gray-100 overflow-hidden grid place-items-center",children:(0,n.jsx)("span",{className:"text-[10px] font-bold text-gray-700 text-center px-1 leading-tight",children:r.split(" ").slice(0,2).join(" ")})}),(0,n.jsxs)("div",{className:`mt-2 text-[11px] leading-tight text-center ${t?"text-[#0B6EA9] font-semibold":"text-gray-700"}`,children:[(0,n.jsx)("div",{children:r}),(0,n.jsx)("div",{className:"text-[9px] text-gray-500",children:a})]})]},e.id)})]}),(0,n.jsx)("div",{className:"p-3",children:(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:p?(0,n.jsx)("div",{className:"col-span-2 bg-white rounded-2xl border p-4 text-sm text-gray-600",children:"Loading..."}):(0,n.jsxs)(n.Fragment,{children:[W.map(e=>{var t;let r,i,l,d=(t=e.id,i=E.find(e=>e.product_id===t&&e.is_primary),l=E.find(e=>e.product_id===t),(r=String((i?.url||l?.url||"/example.png")??"").trim())&&(r.startsWith("/")||r.startsWith("http://")||r.startsWith("https://"))?r:"/example.png"),o=$(e.id),c=o.length>0,u=B[e.id]??q(e.id),x=O(e.id,u),h=T(e.id,u,e.base_price),f=((e,t)=>{if(null==t)return null;let r=O(e,t);return r?.mrp??null})(e.id,u),p=x?.label??"",b=f&&h?Math.round((f-h)/f*100):null,y=o.slice(0,3),N=Math.max(0,o.length-y.length);return(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden",children:[(0,n.jsxs)("div",{className:"relative p-2",children:[p?(0,n.jsx)("div",{className:"absolute right-2 bottom-2 text-[10px] px-2 py-0.5 rounded-full bg-black/70 text-white",children:p}):null,F===e.id?(0,n.jsx)("div",{className:"absolute left-2 top-2 text-[11px] px-2 py-1 rounded-full bg-green-600 text-white font-bold shadow",children:"en"===g?"Added ✓":"Waa la daray ✓"}):null,(0,n.jsx)(s(),{href:`/product/${e.slug}`,className:"block",children:(0,n.jsx)(a.default,{src:d,alt:e.name,width:220,height:220,className:"mx-auto h-28 w-auto object-contain"})})]}),(0,n.jsxs)("div",{className:"px-3 pb-3",children:[(0,n.jsx)("div",{className:"text-[12px] text-gray-900 line-clamp-2 min-h-[34px]",children:e.name}),c?(0,n.jsxs)("div",{className:"mt-1 flex flex-wrap gap-1.5",children:[y.map(t=>{let r=t.id===u;return(0,n.jsx)("button",{onClick:()=>P(r=>({...r,[e.id]:t.id})),className:`h-7 px-2 rounded-full border text-[11px] font-semibold ${r?"border-[#0B6EA9] bg-[#EAF4FB] text-[#0B6EA9]":"bg-white text-gray-700"}`,children:t.label},t.id)}),N>0?(0,n.jsxs)(s(),{href:`/product/${e.slug}`,className:"h-7 px-2 rounded-full border text-[11px] font-semibold bg-white text-[#0B6EA9] grid place-items-center",children:["+",N," ","en"===g?"more":"kale"]}):null]}):(0,n.jsx)("div",{className:"h-[28px]"}),(0,n.jsxs)("div",{className:"mt-2 flex items-end gap-2",children:[(0,n.jsx)("div",{className:"text-[14px] font-extrabold text-gray-900",children:m(h)}),f?(0,n.jsx)("div",{className:"text-[11px] text-gray-400 line-through",children:m(f)}):null]}),b?(0,n.jsxs)("div",{className:"text-[12px] font-semibold text-red-600",children:[b,"% ","en"===g?"Off":"Dhimis"]}):(0,n.jsx)("div",{className:"h-[18px]"}),(0,n.jsx)(L,{productId:e.id,basePrice:e.base_price,selectedVariantId:u}),(0,n.jsxs)("div",{className:"mt-2 h-7 rounded-lg bg-[#E8F5EE] text-[#0F8A4B] text-xs font-semibold grid place-items-center",children:["⚡ ","en"===g?"Quick":"Degdeg"]})]})]},e.id)}),0===W.length&&(0,n.jsx)("div",{className:"col-span-2 bg-white rounded-2xl border p-4 text-sm text-gray-600",children:"en"===g?"No products found in this section.":"Alaab lagama helin qaybtaan."})]})})})]}),Z.count>0&&(0,n.jsx)("div",{className:"fixed left-0 right-0 bottom-4 z-40",children:(0,n.jsx)("div",{className:"mx-auto max-w-md px-3",children:(0,n.jsxs)(s(),{href:"/cart",className:"flex items-center justify-between bg-[#0B6EA9] text-white rounded-2xl px-4 py-3 shadow-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"text-xs opacity-90",children:[Z.count," ","en"===g?"item":"shay",Z.count>1?"s":""," ","en"===g?"in cart":"gaadhiga ku jira"]}),(0,n.jsx)("div",{className:"text-lg font-extrabold",children:m(Z.total)})]}),(0,n.jsxs)("div",{className:"text-right leading-tight font-extrabold",children:[(0,n.jsx)("div",{children:"en"===g?"Go to Cart →":"U gudub Gaadhiga →"}),(0,n.jsx)("div",{className:"text-[10px] opacity-80",children:"en"===g?"U gudub Gaadhiga":"Go to Cart"})]})]})})})]})}},3321:(e,t,r)=>{"use strict";var n=r(4645);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},7270:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>f,HZ:()=>w,J:()=>m,TW:()=>p,Tl:()=>x,VR:()=>i,Xo:()=>o,cg:()=>y,dC:()=>u,eN:()=>d,fS:()=>N,hB:()=>c,iV:()=>s,ii:()=>l,lN:()=>a,lv:()=>b,ob:()=>h,wR:()=>g});var n=r(117);function a(e){let t=String(e??"").trim();return t&&(t.startsWith("/")||t.startsWith("http://")||t.startsWith("https://"))?t:"/example.png"}async function i(){let{data:e,error:t}=await n.N.from("categories").select("id,slug,img,name_so,name_en").order("id",{ascending:!0});if(t)throw t;let{data:r,error:a}=await n.N.from("subcategories").select("id,category_id,slug,img,name_so,name_en").order("id",{ascending:!0});if(a)throw a;let i=r??[];return(e??[]).map(e=>({...e,subcats:i.filter(t=>t.category_id===e.id)}))}async function s(){let{data:e,error:t}=await n.N.from("categories").select("*").order("id");if(t)throw t;return e??[]}async function l(){let{data:e,error:t}=await n.N.from("subcategories").select("*").order("id");if(t)throw t;return e??[]}async function d(){let{data:e,error:t}=await n.N.from("products").select("*").order("id");if(t)throw t;return e??[]}async function o(){let{data:e,error:t}=await n.N.from("product_variants").select("*").order("id");if(t)throw t;return e??[]}async function c(){let{data:e,error:t}=await n.N.from("product_images").select("*").order("is_primary",{ascending:!1});if(t)throw t;return e??[]}async function u(e){let{data:t,error:r}=await n.N.from("subcategories").select("*").eq("slug",e).maybeSingle();if(r)throw console.error("fetchSubcategoryBySlug error:",{slug:e,error:r}),r;return t}async function m(e){let{data:t,error:r}=await n.N.from("products").select("*").eq("subcategory_id",e).order("id",{ascending:!0});if(r)throw r;return t??[]}async function x(e){let{data:t,error:r}=await n.N.from("subsubcategories").select("*").eq("subcategory_id",e).order("id",{ascending:!0});return r?[]:t??[]}async function h(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:a}=await n.N.from("products").select("id,name,slug,long_description,category_id,subcategory_id,brand_id,is_discounted,base_price,tags,is_active").in("id",t);if(a)throw a;return r??[]}async function f(e){let t=Array.from(new Set(e)).filter(e=>null!=e);if(0===t.length)return[];let{data:r,error:a}=await n.N.from("product_variants").select("id,product_id,label,price,stock").in("id",t);if(a)throw a;return r??[]}async function g(e){return h(e)}async function p(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:a}=await n.N.from("product_variants").select("*").in("product_id",t).order("price",{ascending:!0});if(a)throw a;return r??[]}async function b(e){let t=Array.from(new Set(e)).filter(Boolean);if(0===t.length)return[];let{data:r,error:a}=await n.N.from("product_images").select("*").in("product_id",t).order("is_primary",{ascending:!1});if(a)throw a;return r??[]}async function y(e){let t=e.trim();if(!t)return[];let{data:r,error:a}=await n.N.from("customers").select("id,name,phone").or(`name.ilike.%${t}%,phone.ilike.%${t}%`).limit(8);if(a)throw a;return r??[]}async function N(e){let{data:t,error:r}=await n.N.from("orders").insert({customer_id:e.customer_id,delivery_name:e.delivery.name,delivery_phone:e.delivery.phone,delivery_address:e.delivery.address,delivery_note:e.delivery.note??null,total_amount:e.total_amount,status:"PENDING"}).select("id").single();if(r)throw r;return t}async function w(e,t){let r=t.map(t=>({order_id:e,product_id:t.productId,variant_id:t.variantId,quantity:t.qty,price_at_purchase:t.priceAtPurchase})),{error:a}=await n.N.from("order_items").insert(r);if(a)throw console.log("ORDER_ITEMS_INSERT_ERROR",a),a}},8029:(e,t,r)=>{"use strict";r.d(t,{LanguageProvider:()=>d,o:()=>o});var n=r(5155),a=r(2115);let i=(0,a.createContext)(null),s="lang_v1",l="lang";function d({children:e}){let[t,r]=(0,a.useState)("so");return(0,a.useEffect)(()=>{let e=function(e){if("undefined"==typeof document)return"";let t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):""}(l)||null,t=localStorage.getItem(s)||null;r(e||t||"so")},[]),(0,n.jsx)(i.Provider,{value:{lang:t,setLang:e=>{r(e),localStorage.setItem(s,e),function(e,t,r=365){let n=new Date;n.setTime(n.getTime()+24*r*36e5),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${n.toUTCString()}; path=/`}(l,e)}},children:e})}function o(){let e=(0,a.useContext)(i);if(!e)throw Error("useLanguage must be used within LanguageProvider");return e}},8561:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>s,_:()=>l});var n=r(5155),a=r(2115);let i=(0,a.createContext)(null);function s({children:e}){let[t,r]=(0,a.useState)([]);function s(e,t){r(r=>r.filter(r=>r.productId!==e||r.variantId!==t))}return(0,a.useEffect)(()=>{let e=localStorage.getItem("cart");e&&r(JSON.parse(e))},[]),(0,a.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(t))},[t]),(0,n.jsx)(i.Provider,{value:{items:t,addItem:function(e,t,n=1){r(r=>r.find(r=>r.productId===e&&r.variantId===t)?r.map(r=>r.productId===e&&r.variantId===t?{...r,qty:r.qty+n}:r):[...r,{productId:e,variantId:t,qty:n}])},setQty:function(e,t,n){n<=0?s(e,t):r(r=>r.map(r=>r.productId===e&&r.variantId===t?{...r,qty:n}:r))},removeItem:s,clearCart:function(){r([])}},children:e})}function l(){let e=(0,a.useContext)(i);if(!e)throw Error("useCart must be used inside CartProvider");return e}},9312:(e,t,r)=>{Promise.resolve().then(r.bind(r,2642))}},e=>{e.O(0,[500,958,772,441,794,358],()=>e(e.s=9312)),_N_E=e.O()}]);